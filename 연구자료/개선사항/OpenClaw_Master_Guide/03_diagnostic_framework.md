# [섹션 4] 현재 세팅 진단 프레임워크

## 목적
사용자가 자기 세팅을 스스로 분석하고 개선점을 찾을 수 있는 도구 제공

---

## 1. 자가진단 체크리스트 (25항목)

### 기본 설정 (1-5)
- [ ] 1. OpenClaw Gateway가 정상적으로 실행 중인가?
- [ ] 2. 에이전트별 모델이 할당되었는가?
- [ ] 3. 메모리 제한(contextTokens)이 적절하게 설정되었는가?
- [ ] 4. 채널별 연결(Telegram, iMessage 등)이 활성화되었는가?
- [ ] 5. 로그 레벨이 디버깅에 적합한가?

### 에이전트 구성 (6-10)
- [ ] 6. AGENTS.md에 각 에이전트의 역할이 명확히 정의되었는가?
- [ ] 7. SOUL.md에 에이전트의 성격/말투가 설정되었는가?
- [ ] 8. 세션 기본 설정(temperature, maxTokens)이 최적화되었는가?
- [ ] 9. A2A 통신(sessions_send)이 활성화되었는가?
- [ ] 10. 하위 에이전트(spawn) 사용 시 제한이 설정되었는가?

### 리소스 관리 (11-14)
- [ ] 11. 일일/월간 토큰 제한이 설정되었는가?
- [ ] 12. 비용 알림(Cost alerts)이 설정되었는가?
- [ ] 13. 스크립트/도구 사용 제한이 적절한가?
- [ ] 14. 백그라운드 실행 시간 제한이 있는가?

### 스킬/기능 (15-18)
- [ ] 15. 사용할 스킬 리스트가 정의되었는가?
- [ ] 16. 스킬별 호출 제한이 설정되었는가?
- [ ] 17. 웹 검색/브라우저 제어가 활성화되었는가?
- [ ] 18. 파일 읽기/쓰기 경로가 허용되었는가?

### 보안/프라이버시 (19-20)
- [ ] 19. 민감 정보 API Key가 안전하게 관리되는가?
- [ ] 20. 세션/로그에 개인정보 노출 방지가 설정되었는가?

### 오픈크롤봇 특화 (21-25)
- [ ] 21. 사용할 스킬만 필터링했는가? (skills.allowlist)
- [ ] 22. MEMORY.md 경로가 설정되었는가? (memorySearch.extraPaths)
- [ ] 23. tools 권한이 적절한가? (exec, browser, web_search)
- [ ] 24. 크론 잡이 설정되었는가? (자동 리마인더)
- [ ] 25. A2A 통신(sessions_send) 권한이 있는가?

---

## 2. 성능 벤치마크 기준

### 응답 속도
| 작업 유형 | 빠름 | 보통 | 느림 |
|-----------|------|------|------|
| 간단 질문 | < 2초 | 2-5초 | > 5초 |
| 코드 작성 | < 8초 | 8-15초 | > 15초 |
| 리서치 | < 25초 | 25-50초 | > 50초 |

### 토큰 효율성
| 수준 | 1회 대화 평균 | 캐시 히트율 |
|------|---------------|-------------|
| 우수 | < 2K 토큰 | 30-50% |
| 보통 | 2K-5K 토큰 | 10-30% |
| 개선 필요 | > 5K 토큰 | < 10% |

### 비용 효율성
| 수준 | 월 비용 | 최적화 정도 |
|------|---------|-------------|
| 목표 | < $10 | 캐시 + 라우팅 + 배칭 |
| 주의 | $10-30 | 일부 최적화 |
| 개선 필요 | > $30 | 기본 설정만 |

**최적화 팁:**
- 출력이 입력보다 4배 비쌈 → 간결한 응답 유도
- 캐시 히트율 30% 이상 목표
- 배칭으로 추정치)

### 세션 관리
- **건강**: 최근 30일 세션 삭제 자동화
- **주의**: 세션 계속 누적
- **개선 필요**: 100+ 세션 누적

---

## 3. 개선점 발견 질문지

### 성능 관련
1. 평균 응답 시간이 얼마나 걸리나?
2. 비용이 예상보다 높다면, 어느 부분이 주원인인가?
3. 동시에 여러 세션을 돌릴 때 느려지는가?

### 기능 관련
4. 필요한 스킬이 없나?
5. 특정 작업에서 에러가 반복되나?
6. 에이전트 간 통신이 원활한가?

### 사용성 관련
7. 원하는 결과가 나오지 않는 경우가 얼마나 자주 있나?
8. 프롬프트를 수정해야 하는가?
9. 특정 에이전트의 응답이 일관성이 없는가?

---

## 4. 일반적인 실수 & 해결책

### 실수 1: ContextTokens 설정 오류

#### 너무 낮게 설정할 때
- 증상: 맥락 상실, 반복 질문, 긴 대화에서 이전 내용 잊음
- 해결: 복잡한 작업은 64K+, 토론/협업은 128K+

#### 너무 높게 설정할 때
- 증상: 비용 폭증, 응답 느림, 불필요한 토큰 소모
- 해결: 간단 작업은 8K-16K

| 작업 유형 | 추천 contextTokens |
|----------|-------------------|
| 간단 질문 | 8K-16K |
| 코드 리뷰 | 32K-64K |
| 복잡 리서치 | 128K+ |
| 토론/협업 | 64K-128K |

### 실수 2: Temperature 너무 높게 설정
- 증상: 응답 일관성 없음, 반복 질문
- 해결: 기본 0.3-0.7, 창의적 작업만 0.8+

### 실수 3: 스킬 제한 없음
- 증상: 비용 폭증, 오류 반복
- 해결: 스킬별 호출 제한 설정

### 실수 4: 로그/세션 누적
- 증상: 느려짐, 디스크 공간 부족
- 해결: 주기적 세션 정리, 로그 순환

### 실수 5: A2A 통신 활성화 안 함
- 증상: 팀 협업 불가
- 해결: sessions_send 권한 부여

### 실수 6: 모델 라우팅 미사용
- 증상: 간단 작업에도 비싼 모델 사용
- 해결: 작업 유형별 모델 분배 (간단: GPT-4o-mini, 복잡: Claude Opus)

### 실수 7: 캐시 비활성화
- 증상: 반복 쿼리로 비용 낭비
- 해결: 캐시 활성화, TTL 1h 설정

### 실수 8: 배칭 미사용
- 증상: 유사 쿼리 개별 처리
- 해결: 유사 쿼리 묶어서 API 호출 줄이기 (20-30% 절감)

### 실수 9: 예산 한도 미설정
- 증상: 런어웨이 비용
- 해결: 월 예산 $10 설정, 80% 도달 시 알림

### 실수 10: 출력 토큰 과다
- 증상: 불필요하게 긴 응답
- 해결: 간결한 응답 유도, 불필요한 설명 제거

---

## 5. 점수 매기기 가이드

### 채점 방식
- **Yes**: 1점
- **No**: 0점
- **부분**: 0.5점

### 결과 해석 (25항목 기준)
- **20-25점**: 우수 - 정기 점검만
- **15-19점**: 보통 - 몇 가지 개선 필요
- **10-14점**: 주의 - 핵심 항목 개선 우선
- **0-9점**: 개선 필요 - 기본 설정부터 재검토

---

## 6. 우선순위별 개선 로드맵 템플릿

### 우선순위 1 (즉시)
- [ ] 비용 초과 방지 (토큰 제한)
- [ ] 기본 연결 확인 (채널, Gateway)
- [ ] 에이전트 역할 정의 (AGENTS.md)

### 우선순위 2 (1주 이내)
- [ ] 응답 속도 최적화 (contextTokens, temperature)
- [ ] 스킬 필터링 (불필요한 스킬 비활성화)
- [ ] 로그/세션 정리 자동화

### 우선순위 3 (1개월 이내)
- [ ] A2A 통신 활성화 (팀 협업)
- [ ] 커스텀 스킬 개발
- [ ] 모니터링/알림 설정

---

*다음 파일로 계속: 04-telegram-assistant-guide.md*
