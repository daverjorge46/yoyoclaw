# 오픈클로(OpenClaw) 설치 및 설정 가이드

> 이 문서는 OpenClaw 공식 리포지토리의 설치/플랫폼/설정 문서를 기반으로 작성되었다.
> 초보자도 단계별로 따라할 수 있도록 구성하였으며, 모든 명령어는 실제 프로젝트 소스와 일치한다.

---

## 목차

1. [설치 방법 비교](#1-설치-방법-비교)
2. [OS별 설치 가이드](#2-os별-설치-가이드)
3. [최초 온보딩 (openclaw onboard)](#3-최초-온보딩)
4. [환경 설정](#4-환경-설정)
5. [AI 프로바이더 연결](#5-ai-프로바이더-연결)
6. [데몬/서비스 설정](#6-데몬서비스-설정)
7. [업데이트 및 마이그레이션](#7-업데이트-및-마이그레이션)
8. [Docker 배포](#8-docker-배포)
9. [클라우드 배포](#9-클라우드-배포)
10. [초기 트러블슈팅](#10-초기-트러블슈팅)

---

## 1. 설치 방법 비교

### 시스템 요구사항

- **Node.js 22 이상** (필수)
- macOS, Linux, 또는 Windows(WSL2 경유)
- pnpm (소스 빌드 시 필요)

### 설치 방법 비교표

| 방법 | 명령어 | 장점 | 단점 | 권장 대상 |
|------|--------|------|------|-----------|
| **인스톨러 스크립트** (권장) | `curl -fsSL https://openclaw.bot/install.sh \| bash` | 원클릭, 온보딩 자동 실행 | 셸 파이프 실행 | 처음 사용자 |
| **npm 글로벌** | `npm install -g openclaw@latest` | 표준적, 버전 관리 용이 | PATH 설정 필요할 수 있음 | Node.js 개발자 |
| **Docker** | `./docker-setup.sh` | 격리된 환경, 재현성 | Docker 설치 필요, 리소스 사용량 증가 | 서버/VPS 배포 |
| **Nix** | Home Manager 모듈 | 결정적 빌드, 롤백 가능 | Nix 학습 곡선 | NixOS 사용자 |
| **소스 빌드** | `git clone` + `pnpm build` | 최신 코드, 커스터마이징 가능 | 빌드 시간, 의존성 관리 | 기여자/개발자 |
| **Bun** (실험적) | `bun install` | 빠른 설치 | WhatsApp/Telegram 버그 존재, 비권장 | 테스트 목적 |

### Windows 전용 인스톨러

```powershell
iwr -useb https://openclaw.ai/install.ps1 | iex
```

### 인스톨러 스크립트 옵션

`install.sh`는 다양한 플래그를 지원한다:

| 플래그 | 설명 |
|--------|------|
| `--install-method npm\|git` | 설치 방식 선택 |
| `--git-dir <path>` | git 클론 경로 (기본: `~/openclaw`) |
| `--no-onboard` | 온보딩 건너뛰기 |
| `--no-prompt` | CI 환경용 비대화 모드 |
| `--dry-run` | 실제 실행 없이 계획만 출력 |

환경변수로도 동일하게 제어할 수 있다:

```bash
OPENCLAW_INSTALL_METHOD=npm OPENCLAW_NO_ONBOARD=1 \
  curl -fsSL https://openclaw.bot/install.sh | bash
```

### CLI 전용 인스톨러 (비-root)

root 권한 없이 `~/.openclaw` 디렉토리에 Node + OpenClaw를 설치하는 별도 스크립트:

```bash
curl -fsSL https://openclaw.bot/install-cli.sh | bash
```

---

## 2. OS별 설치 가이드

### macOS

macOS는 컴패니언 앱(메뉴바 앱)과 Node.js 게이트웨이를 모두 지원한다.

```bash
# 1. Node 22+ 설치 (Homebrew 권장)
brew install node@22

# 2. OpenClaw 설치
curl -fsSL https://openclaw.bot/install.sh | bash

# 3. 온보딩 + 데몬 설치
openclaw onboard --install-daemon
```

**컴패니언 앱 기능:**
- 메뉴바 게이트웨이 관리
- TCC 권한 관리 (카메라, 화면 녹화 등)
- macOS 전용 도구: Canvas, Camera, Screen, System
- Deep link 지원: `openclaw://agent?message=...`

**Launchd 서비스:**
- 서비스 레이블: `bot.molt.gateway` (기본 프로필), `bot.molt.<profile>` (네임드 프로필)
- 재시작: `launchctl kickstart -k gui/$UID/bot.molt.gateway`
- 제거: `launchctl bootout gui/$UID/bot.molt.gateway`

### Linux (Ubuntu/Debian)

```bash
# 1. Node 22+ 설치
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt install -y nodejs

# 2. OpenClaw 설치
npm install -g openclaw@latest

# 3. 온보딩 + systemd 서비스 설치
openclaw onboard --install-daemon

# 4. 서비스 확인
systemctl --user status openclaw-gateway
```

**npm PATH 문제 해결:**

글로벌 npm 바이너리 경로가 PATH에 없을 수 있다:

```bash
# 진단
npm prefix -g    # 글로벌 prefix 확인
echo "$PATH"     # 현재 PATH 확인

# 해결: ~/.bashrc 또는 ~/.zshrc에 추가
export PATH="$(npm prefix -g)/bin:$PATH"
```

**Linux npm 권한 문제 해결:**

```bash
# prefix를 홈 디렉토리로 변경
npm config set prefix "$HOME/.npm-global"
export PATH="$HOME/.npm-global/bin:$PATH"
# 위 export를 ~/.bashrc에도 추가
```

**VPS 원격 접속:**

```bash
# SSH 터널로 대시보드 접근
ssh -N -L 18789:127.0.0.1:18789 user@your-server
# 브라우저에서 http://127.0.0.1:18789/ 접속
```

### Windows (WSL2)

OpenClaw는 네이티브 Windows를 지원하지 않는다. WSL2 내에서 Linux와 동일하게 설치한다.

```powershell
# 1. WSL2 설치 (PowerShell 관리자 모드)
wsl --install
# 또는 특정 배포판 지정
wsl --install -d Ubuntu-24.04
```

```bash
# 2. WSL2 내부에서 systemd 활성화
sudo tee /etc/wsl.conf <<'EOF'
[boot]
systemd=true
EOF
# WSL 재시작 후 확인
systemctl --user status
```

```bash
# 3. 이후 Linux 가이드와 동일하게 진행
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt install -y nodejs
curl -fsSL https://openclaw.bot/install.sh | bash
openclaw onboard --install-daemon
```

**Windows에서 WSL 포트 포워딩:**

외부 기기에서 WSL 내부의 OpenClaw에 접속해야 할 경우:

```powershell
# PowerShell (관리자)
$WslIp = (wsl hostname -I).Trim()
netsh interface portproxy add v4tov4 `
  listenaddress=0.0.0.0 listenport=2222 `
  connectaddress=$WslIp connectport=22

New-NetFirewallRule -DisplayName "WSL SSH 2222" `
  -Direction Inbound -Protocol TCP -LocalPort 2222 -Action Allow
```

### Raspberry Pi

| 모델 | RAM | 권장도 |
|------|-----|--------|
| Pi 5 (4GB/8GB) | 4-8GB | 최적 |
| Pi 4 (4GB) | 4GB | 양호 (Sweet spot) |
| Pi 4 (2GB) | 2GB | Swap 필요 |
| Pi 3B+ | 1GB | 느리지만 동작 |
| Pi Zero 2 W | 512MB | 비권장 |

```bash
# 1. Raspberry Pi OS Lite (64-bit) 플래시
# 2. SSH 접속
ssh user@gateway-host

# 3. 시스템 준비
sudo apt update && sudo apt upgrade -y
sudo apt install -y git curl build-essential

# 4. 타임존 설정
sudo timedatectl set-timezone Asia/Seoul

# 5. Node 22 설치
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt install -y nodejs

# 6. Swap 설정 (2GB RAM 이하인 경우)
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
# /etc/fstab에 영구 등록
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

# 7. OpenClaw 설치 + 온보딩
curl -fsSL https://openclaw.bot/install.sh | bash
openclaw onboard --install-daemon

# 8. 확인
openclaw status
```

**Raspberry Pi 주의사항:**
- 로컬 LLM(Ollama 등)은 성능 한계로 비권장. API 기반 모델(Claude, GPT) 사용 권장.
- USB SSD 사용 시 성능이 크게 향상된다.
- 불필요한 GPU 메모리 할당과 Bluetooth를 비활성화하면 RAM 여유가 생긴다.

**원격 접속 (Tailscale):**

```bash
curl -fsSL https://tailscale.com/install.sh | sh
sudo tailscale up
# 이후 Tailscale IP로 어디서든 접속 가능
```

---

## 3. 최초 온보딩

### `openclaw onboard` 명령어

설치 후 반드시 온보딩 위자드를 실행해야 한다:

```bash
openclaw onboard --install-daemon
```

### 온보딩 단계별 흐름

#### Step 1: 기존 설정 감지

기존 `~/.openclaw/openclaw.json`이 있으면 선택지가 나타난다:
- **Keep**: 기존 설정 유지
- **Modify**: 기존 설정 위에서 수정
- **Reset**: 초기화 후 새로 설정

#### Step 2: 모드 선택 (QuickStart vs Advanced)

- **QuickStart**: 기본값 사용 (loopback 바인드, token 인증, 포트 18789, allowlist DM 정책)
- **Advanced**: 각 항목을 직접 설정

#### Step 3: 모델/인증 선택

지원하는 AI 프로바이더:
- Anthropic (API key / OAuth / token)
- OpenAI (Code subscription / API key)
- Google Gemini
- MiniMax
- Moonshot
- Vercel AI Gateway
- Synthetic
- OpenCode Zen
- Z.AI

#### Step 4: Workspace 설정

기본 workspace 경로: `~/.openclaw/workspace`
사용자 지정 가능.

#### Step 5: 게이트웨이 설정

| 항목 | 기본값 | 설명 |
|------|--------|------|
| 포트 | `18789` | HTTP API + 대시보드 |
| 바인드 | `loopback` | `127.0.0.1`만 리슨 |
| 인증 | `token` | 토큰 기반 접근 제어 |
| Tailscale | `off` | HTTPS 서빙 비활성 |

#### Step 6: 채널 설정

온보딩 중 또는 이후에 채널을 추가할 수 있다:

| 채널 | 설정 방법 |
|------|-----------|
| WhatsApp | QR 코드 스캔 (`openclaw channels login`) |
| Telegram | Bot 토큰 입력 |
| Discord | Bot 토큰 입력 |
| Google Chat | 서비스 계정 설정 |
| Mattermost | Webhook URL |
| Signal | Signal CLI 연동 |
| iMessage | macOS 전용 |

#### Step 7: 데몬 설치

- macOS: LaunchAgent 설치
- Linux: systemd user service 설치
- 런타임 선택: Node (권장) 또는 Bun

#### Step 8: Health Check

게이트웨이 자동 시작 + 상태 확인.

### 비대화형(Non-interactive) 온보딩

CI/CD나 자동화 환경에서 사용:

```bash
openclaw onboard --non-interactive \
  --mode local \
  --auth-choice apiKey \
  --anthropic-api-key "$ANTHROPIC_API_KEY" \
  --gateway-port 18789 \
  --gateway-bind loopback \
  --install-daemon \
  --daemon-runtime node \
  --skip-skills
```

### 추가 에이전트 등록

별도의 workspace/세션/인증으로 에이전트를 추가할 수 있다:

```bash
openclaw agents add <name>
```

---

## 4. 환경 설정

### 설정 파일 위치

기본 설정 파일: `~/.openclaw/openclaw.json` (JSON5 형식, 주석/후행 쉼표 허용)

> 스키마 검증이 엄격하여 **알 수 없는 키가 있으면 게이트웨이가 시작되지 않는다**.

### 최소 설정 예시

```json5
{
  agents: {
    defaults: {
      workspace: "~/.openclaw/workspace"
    }
  },
  channels: {
    whatsapp: {
      allowFrom: ["+821012345678"]
    }
  }
}
```

### 설정 파일 분할 ($include)

큰 설정을 여러 파일로 나눌 수 있다:

```json5
{
  agents: { "$include": "./agents.json5" },
  broadcast: {
    "$include": [
      "./clients/client-a.json5",
      "./clients/client-b.json5"
    ]
  }
}
```

### 환경변수 로딩 우선순위

높은 우선순위부터:

1. **프로세스 환경** - 부모 셸/데몬에서 상속
2. **`.env` (CWD)** - 현재 작업 디렉토리의 `.env`
3. **`~/.openclaw/.env`** - 글로벌 `.env`
4. **`openclaw.json`의 `env` 블록** - 설정 파일 내 정의
5. **셸 환경 임포트** - `env.shellEnv.enabled=true` 시 로그인 셸에서 가져옴

### 설정 파일 내 환경변수 정의

```json5
{
  env: {
    OPENROUTER_API_KEY: "sk-or-...",
    vars: {
      GROQ_API_KEY: "gsk-..."
    }
  }
}
```

### 셸 환경 임포트

시스템 셸의 환경변수를 자동으로 가져오려면:

```json5
{
  env: {
    shellEnv: {
      enabled: true,
      timeoutMs: 15000
    }
  }
}
```

### 환경변수 치환

설정 문자열 내에서 `${VAR_NAME}` 구문으로 환경변수를 참조할 수 있다 (대문자만 허용, 없으면 에러):

```json5
{
  someKey: "${MY_SECRET_VALUE}"
}
```

### 주요 설정 항목

| 설정 경로 | 설명 | 기본값 |
|-----------|------|--------|
| `agents.defaults.workspace` | 에이전트 작업 디렉토리 | `~/.openclaw/workspace` |
| `channels.whatsapp.dmPolicy` | DM 정책 | `"pairing"` |
| `channels.whatsapp.allowFrom` | 허용 번호 목록 (E.164) | `[]` |
| `agents.list[].identity` | 에이전트 이름/테마/아바타 | - |
| `logging.level` | 로그 레벨 | `"info"` |
| `env.shellEnv.enabled` | 셸 환경 임포트 | `false` |

### Config RPC (프로그래밍 방식)

```bash
# 단일 값 설정
openclaw config set gateway.bind loopback

# 값 조회
openclaw config get gateway.port
```

내부적으로 `config.apply` (검증 + 쓰기 + 재시작)와 `config.patch` (부분 병합) RPC를 사용한다.

---

## 5. AI 프로바이더 연결

### 지원 프로바이더 목록

| 프로바이더 | 인증 방식 | 설정 명령어 |
|-----------|-----------|-------------|
| **Anthropic** (권장) | API Key / OAuth / Token | `openclaw models auth setup-token --provider anthropic` |
| **OpenAI** | Code Subscription / API Key | `openclaw models auth setup-token --provider openai` |
| **Google Gemini** | API Key | 온보딩 위자드에서 설정 |
| **Ollama** (로컬) | 인증 불필요 | 온보딩 시 선택 |
| **MiniMax** | API Key | 온보딩 위자드에서 설정 |
| **Moonshot** | API Key | 온보딩 위자드에서 설정 |
| **Vercel AI Gateway** | 설정에 따라 다름 | 온보딩 위자드에서 설정 |
| **OpenCode Zen** | API Key | 온보딩 위자드에서 설정 |
| **Z.AI** | API Key | 온보딩 위자드에서 설정 |

### API 키 설정 방법

**방법 1: 온보딩 위자드에서 설정**

```bash
openclaw onboard
# 프로바이더 선택 → API 키 입력
```

**방법 2: 환경변수로 설정**

```bash
# ~/.openclaw/.env 또는 셸 환경에 설정
export ANTHROPIC_API_KEY="sk-ant-..."
export OPENAI_API_KEY="sk-..."
```

**방법 3: 설정 파일의 env 블록**

```json5
{
  env: {
    ANTHROPIC_API_KEY: "sk-ant-...",
  }
}
```

**방법 4: 토큰 기반 인증**

```bash
openclaw models auth setup-token --provider anthropic
```

### 인증 갱신

OAuth 토큰이 만료된 경우:

```bash
# 토큰 방식으로 전환
openclaw models auth setup-token --provider anthropic

# 또는 doctor로 자동 수리
openclaw doctor
```

---

## 6. 데몬/서비스 설정

### macOS: LaunchAgent (launchd)

온보딩 시 `--install-daemon` 플래그로 자동 설치된다.

```bash
# 수동 설치
openclaw gateway install

# 서비스 레이블
# 기본 프로필: bot.molt.gateway
# 네임드 프로필: bot.molt.<profile>

# 서비스 제어
launchctl kickstart -k gui/$UID/bot.molt.gateway    # 재시작
launchctl bootout gui/$UID/bot.molt.gateway          # 제거

# OpenClaw CLI로 제어
openclaw gateway start
openclaw gateway stop
openclaw gateway restart
openclaw gateway status
```

### Linux: systemd user service

```bash
# 설치 (아래 중 하나)
openclaw onboard --install-daemon
openclaw gateway install
openclaw configure
```

**생성되는 systemd 유닛:**

서비스명: `openclaw-gateway.service` (기본) 또는 `openclaw-gateway-<profile>.service`

```ini
[Unit]
Description=OpenClaw Gateway (profile: default, v<version>)
After=network-online.target
Wants=network-online.target

[Service]
ExecStart=/usr/local/bin/openclaw gateway --port 18789
Restart=always
RestartSec=5

[Install]
WantedBy=default.target
```

```bash
# 서비스 활성화 + 시작
systemctl --user enable --now openclaw-gateway.service

# 상태 확인
systemctl --user status openclaw-gateway.service

# 재시작
systemctl --user restart openclaw-gateway.service

# 로그 확인
journalctl --user -u openclaw-gateway.service -f
```

**systemd linger 설정 (SSH 세션 종료 후에도 유지):**

```bash
sudo loginctl enable-linger $USER
```

---

## 7. 업데이트 및 마이그레이션

### 업데이트

**인스톨러 스크립트로 업데이트 (권장):**

```bash
curl -fsSL https://openclaw.bot/install.sh | bash
```

**npm 글로벌 업데이트:**

```bash
npm install -g openclaw@latest
# 또는
pnpm add -g openclaw@latest
```

**소스 빌드 업데이트:**

```bash
openclaw update
# 또는 수동:
cd ~/openclaw
git pull
pnpm install
pnpm build
pnpm ui:build
```

### 업데이트 채널

```bash
openclaw update --channel stable    # 안정 버전 (기본)
openclaw update --channel beta      # 베타 버전
openclaw update --channel dev       # 개발 버전
```

### 업데이트 후 필수 작업

```bash
openclaw doctor              # 설정 마이그레이션 + 상태 점검
openclaw gateway restart     # 게이트웨이 재시작
openclaw health              # 헬스체크
```

### 롤백

```bash
# npm: 특정 버전으로 롤백
npm install -g openclaw@<version>

# 소스: 특정 날짜의 커밋으로 롤백
git fetch origin
git checkout "$(git rev-list -n 1 --before='2026-01-01' origin/main)"
```

### 머신 마이그레이션

다른 머신으로 설정을 옮기는 절차:

```bash
# 1. 기존 머신에서 게이트웨이 중지
openclaw gateway stop

# 2. 상태 디렉토리 백업
tar -czf openclaw-state.tgz ~/.openclaw/
tar -czf openclaw-workspace.tgz ~/.openclaw/workspace/

# 3. 새 머신에 OpenClaw 설치
curl -fsSL https://openclaw.bot/install.sh | bash

# 4. 백업 파일 복사 (scp, rsync, USB 등)
scp openclaw-state.tgz user@new-machine:~/
scp openclaw-workspace.tgz user@new-machine:~/

# 5. 새 머신에서 복원
cd ~
tar -xzf openclaw-state.tgz
tar -xzf openclaw-workspace.tgz

# 6. Doctor 실행 (마이그레이션 + 서비스 수리)
openclaw doctor

# 7. 게이트웨이 재시작
openclaw gateway restart
```

**마이그레이션 주의사항:**
- `openclaw.json`만 복사하면 안 된다. 반드시 `~/.openclaw/` 전체를 복사해야 한다 (인증, 세션, 채널 데이터 포함).
- 프로필/상태 디렉토리 경로가 양쪽 머신에서 동일한지 확인.
- 파일 소유권/퍼미션 확인 (올바른 사용자가 소유해야 함).

---

## 8. Docker 배포

### 요구사항

- Docker Desktop 또는 Docker Engine
- Docker Compose v2

### 빠른 시작 (docker-setup.sh)

```bash
git clone https://github.com/openclaw/openclaw.git
cd openclaw
./docker-setup.sh
```

이 스크립트가 자동으로 수행하는 작업:
1. Docker + Docker Compose 존재 확인
2. `~/.openclaw/` 및 workspace 디렉토리 생성
3. 게이트웨이 토큰 자동 생성
4. `.env` 파일 작성
5. Docker 이미지 빌드
6. 온보딩 실행
7. 게이트웨이 시작

### 수동 Docker 배포

```bash
# 1. 이미지 빌드
docker build -t openclaw:local -f Dockerfile .

# 2. 온보딩
docker compose run --rm openclaw-cli onboard

# 3. 게이트웨이 시작
docker compose up -d openclaw-gateway
```

### docker-compose.yml 구조

```yaml
services:
  openclaw-gateway:
    image: ${OPENCLAW_IMAGE:-openclaw:local}
    environment:
      HOME: /home/node
      TERM: xterm-256color
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN}
    volumes:
      - ${OPENCLAW_CONFIG_DIR}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR}:/home/node/.openclaw/workspace
    ports:
      - "${OPENCLAW_GATEWAY_PORT:-18789}:18789"
      - "${OPENCLAW_BRIDGE_PORT:-18790}:18790"
    restart: unless-stopped
    command: >
      node dist/index.js gateway
      --bind ${OPENCLAW_GATEWAY_BIND:-lan}
      --port ${OPENCLAW_GATEWAY_PORT:-18789}

  openclaw-cli:
    image: ${OPENCLAW_IMAGE:-openclaw:local}
    environment:
      HOME: /home/node
      TERM: xterm-256color
      BROWSER: echo
    volumes:
      - ${OPENCLAW_CONFIG_DIR}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR}:/home/node/.openclaw/workspace
    stdin_open: true
    tty: true
    entrypoint: ["node", "dist/index.js"]
```

### 주요 환경변수 (.env)

| 변수 | 기본값 | 설명 |
|------|--------|------|
| `OPENCLAW_IMAGE` | `openclaw:local` | Docker 이미지명 |
| `OPENCLAW_GATEWAY_TOKEN` | (자동 생성) | 게이트웨이 인증 토큰 |
| `OPENCLAW_CONFIG_DIR` | `$HOME/.openclaw` | 설정 디렉토리 마운트 |
| `OPENCLAW_WORKSPACE_DIR` | `$HOME/.openclaw/workspace` | Workspace 마운트 |
| `OPENCLAW_GATEWAY_PORT` | `18789` | 게이트웨이 포트 |
| `OPENCLAW_BRIDGE_PORT` | `18790` | 브릿지 포트 |
| `OPENCLAW_GATEWAY_BIND` | `lan` | 바인드 모드 |
| `OPENCLAW_DOCKER_APT_PACKAGES` | (없음) | 빌드 시 추가 apt 패키지 |
| `OPENCLAW_EXTRA_MOUNTS` | (없음) | 추가 바인드 마운트 (쉼표 구분) |
| `OPENCLAW_HOME_VOLUME` | (없음) | `/home/node` 영구 볼륨명 |

### Docker 채널 설정

```bash
# WhatsApp QR 코드 스캔
docker compose run --rm openclaw-cli channels login

# Telegram 추가
docker compose run --rm openclaw-cli channels add \
  --channel telegram --token "<BOT_TOKEN>"

# Discord 추가
docker compose run --rm openclaw-cli channels add \
  --channel discord --token "<BOT_TOKEN>"
```

### Docker 헬스체크

```bash
docker compose exec openclaw-gateway \
  node dist/index.js health --token "$OPENCLAW_GATEWAY_TOKEN"
```

### Agent 샌드박스 (Docker-in-Docker)

에이전트가 코드를 실행할 때 격리된 환경을 제공한다:

```bash
# 샌드박스 이미지 빌드
scripts/sandbox-setup.sh
```

- 기본 이미지: `openclaw-sandbox:bookworm-slim`
- 설정 키: `agents.defaults.sandbox.docker.image`
- 보안: Network=none, readOnlyRoot=true, user=1000:1000, capDrop=ALL

---

## 9. 클라우드 배포

### Fly.io

**비용:** ~$10-15/month (shared-cpu-2x + 2GB RAM)

```bash
# 1. 앱 + 볼륨 생성
fly apps create my-openclaw
fly volumes create openclaw_data --size 1 --region iad

# 2. fly.toml 작성
```

`fly.toml` 핵심 내용:

```toml
app = "my-openclaw"
primary_region = "iad"

[build]
dockerfile = "Dockerfile"

[env]
NODE_ENV = "production"
OPENCLAW_PREFER_PNPM = "1"
OPENCLAW_STATE_DIR = "/data"
NODE_OPTIONS = "--max-old-space-size=1536"

[processes]
app = "node dist/index.js gateway --allow-unconfigured --port 3000 --bind lan"

[http_service]
internal_port = 3000
force_https = true
auto_stop_machines = false
auto_start_machines = true
min_machines_running = 1

[[vm]]
size = "shared-cpu-2x"
memory = "2048mb"

[mounts]
source = "openclaw_data"
destination = "/data"
```

```bash
# 3. 시크릿 설정
fly secrets set OPENCLAW_GATEWAY_TOKEN=$(openssl rand -hex 32)
fly secrets set ANTHROPIC_API_KEY=sk-ant-...

# 4. 배포
fly deploy

# 5. 설정 (SSH 콘솔)
fly ssh console

# 6. 접속
fly open  # https://my-openclaw.fly.dev/
```

**프라이빗 배포:** `fly.private.toml`로 퍼블릭 IP 없이 운영, `fly proxy 3000:3000` 또는 WireGuard로 접속.

### Render

```yaml
# render.yaml
services:
  - type: web
    name: openclaw
    runtime: docker
    plan: starter
    healthCheckPath: /health
    envVars:
      - key: PORT
        value: "8080"
      - key: SETUP_PASSWORD
        sync: false
      - key: OPENCLAW_STATE_DIR
        value: /data/.openclaw
      - key: OPENCLAW_WORKSPACE_DIR
        value: /data/workspace
      - key: OPENCLAW_GATEWAY_TOKEN
        generateValue: true
    disk:
      name: openclaw-data
      mountPath: /data
      sizeGB: 1
```

GitHub 리포를 연결하면 자동 배포된다.

### DigitalOcean

**비용:** $6/month (1 vCPU, 1GB RAM, 25GB SSD)

```bash
# 1. Droplet 생성: Ubuntu 24.04 LTS, Basic $6/mo, SSH 키

# 2. SSH 접속
ssh root@YOUR_DROPLET_IP

# 3. 설치
apt update && apt upgrade -y
curl -fsSL https://deb.nodesource.com/setup_22.x | bash -
apt install -y nodejs
curl -fsSL https://openclaw.bot/install.sh | bash
openclaw onboard --install-daemon

# 4. 1GB RAM Droplet은 Swap 추가 권장
fallocate -l 2G /swapfile
chmod 600 /swapfile && mkswap /swapfile && swapon /swapfile
```

### Hetzner

**비용:** ~EUR3.79/month (~$4)

Docker 기반 배포 권장. 자세한 docker-compose 설정과 Dockerfile은 [8. Docker 배포](#8-docker-배포) 참조.

```bash
ssh root@YOUR_VPS_IP
apt-get install -y git curl ca-certificates
curl -fsSL https://get.docker.com | sh

git clone https://github.com/openclaw/openclaw.git
cd openclaw

mkdir -p /root/.openclaw /root/.openclaw/workspace
chown -R 1000:1000 /root/.openclaw

# .env 설정 후
docker compose build
docker compose up -d openclaw-gateway
```

### Oracle Cloud (무료)

**비용:** $0/month (Always Free ARM - 4 OCPU, 24GB RAM, 200GB)

```bash
# 1. OCI 인스턴스 생성: VM.Standard.A1.Flex, Ubuntu 24.04 (aarch64)

# 2. SSH 접속
ssh ubuntu@YOUR_PUBLIC_IP
sudo apt update && sudo apt upgrade -y && sudo apt install -y build-essential

# 3. Tailscale 설치 (보안 접속용)
curl -fsSL https://tailscale.com/install.sh | sh
sudo tailscale up --ssh --hostname=openclaw

# 4. OpenClaw 설치
curl -fsSL https://openclaw.bot/install.sh | bash

# 5. 게이트웨이 설정
openclaw config set gateway.bind loopback
openclaw config set gateway.auth.mode token
openclaw doctor --generate-gateway-token
openclaw config set gateway.tailscale.mode serve
systemctl --user restart openclaw-gateway

# 6. VCN 보안: UDP 41641 (Tailscale)만 남기고 모든 인그레스 규칙 제거
```

접속: `https://openclaw.<tailnet-name>.ts.net/`

### Google Cloud Platform

**비용:** ~$12/month (e2-small), Free tier 가능 (e2-micro)

```bash
# 1. 프로젝트 + VM 생성
gcloud projects create my-openclaw-project
gcloud services enable compute.googleapis.com
gcloud compute instances create openclaw-gateway \
  --zone=us-central1-a \
  --machine-type=e2-small \
  --boot-disk-size=20GB \
  --image-family=debian-12 \
  --image-project=debian-cloud

# 2. SSH 접속
gcloud compute ssh openclaw-gateway --zone=us-central1-a

# 3. 이후 Docker 방식 또는 npm 직접 설치
```

SSH 터널: `gcloud compute ssh openclaw-gateway --zone=us-central1-a -- -L 18789:127.0.0.1:18789`

### 클라우드 비용 비교

| 플랫폼 | 월 비용 | 스펙 | 비고 |
|--------|---------|------|------|
| Oracle Cloud | $0 | 4 OCPU, 24GB RAM (ARM) | Always Free, 용량 확보 어려울 수 있음 |
| Hetzner | ~$4 | 1 vCPU, 2GB RAM | 유럽 DC |
| DigitalOcean | $6 | 1 vCPU, 1GB RAM | Swap 추가 권장 |
| Fly.io | ~$10-15 | 2 shared CPU, 2GB RAM | PaaS, 관리 편리 |
| GCP | ~$12 | 2 vCPU, 2GB RAM | Free tier (e2-micro) 가능 |

---

## 10. 초기 트러블슈팅

### `openclaw doctor` 사용법

OpenClaw의 자가 진단 + 수리 도구:

```bash
# 대화형 진단 + 수리
openclaw doctor

# 기본값 자동 수락
openclaw doctor --yes

# 권장 수정 자동 적용
openclaw doctor --repair

# 공격적 수리 (커스텀 설정 덮어쓸 수 있음)
openclaw doctor --repair --force

# CI 환경용 (안전한 마이그레이션만)
openclaw doctor --non-interactive

# 시스템 전체 스캔
openclaw doctor --deep

# 토큰 자동 생성
openclaw doctor --generate-gateway-token
```

**Doctor가 수행하는 검사 항목:**
1. UI 프로토콜 최신 여부
2. 헬스체크 + 재시작 제안
3. Skills 상태
4. 레거시 설정값 정규화
5. 온디스크 상태 마이그레이션 (세션, 에이전트, WhatsApp 인증)
6. 상태 무결성 + 권한 검사
7. 모델 인증 상태 (OAuth 만료, 리프레시)
8. 샌드박스 이미지 수리
9. 게이트웨이 서비스 마이그레이션
10. 보안 경고 (개방된 DM 정책 등)
11. systemd linger 확인 (Linux)
12. 게이트웨이 런타임 + 포트 진단

### 진단 명령어 모음

| 명령어 | 용도 |
|--------|------|
| `openclaw status` | 로컬 상태 요약 |
| `openclaw status --all` | 전체 로컬 진단 |
| `openclaw status --deep` | 게이트웨이 헬스체크 포함 |
| `openclaw health` | 헬스체크 |
| `openclaw gateway probe` | 디스커버리 + 도달 가능성 |
| `openclaw gateway status` | 슈퍼바이저 상태 |
| `openclaw channels status --probe` | 채널 상태 |
| `openclaw logs --follow` | 실시간 로그 |

### 흔한 에러와 해결법

#### API 키가 없다는 에러

인증은 에이전트별로 설정된다. 새 에이전트 추가 시 온보딩을 다시 실행:

```bash
openclaw onboard
```

#### OAuth 토큰 갱신 실패

```bash
# 토큰 방식으로 전환
openclaw models auth setup-token --provider anthropic
```

#### 대시보드 HTTP 접속 실패

Control UI는 HTTPS가 필요할 수 있다:
- Tailscale Serve 사용
- 또는 loopback(`127.0.0.1`) 접속

#### 서비스가 설치되었는데 실행되지 않음

```bash
openclaw gateway status
openclaw doctor --fix
```

#### 포트 18789가 이미 사용 중

```bash
lsof -i :18789
# 충돌하는 프로세스를 확인하고 종료 또는 포트 변경
openclaw config set gateway.port 18790
```

#### WhatsApp 연결 끊김

보통 자동 재연결된다. 지속되면:

```bash
openclaw gateway restart
```

#### Pairing 코드가 도착하지 않음

채널당 최대 3개까지 제한된다:

```bash
openclaw pairing list <channel>
```

#### 높은 메모리 사용량

세션 히스토리 제한을 설정하거나 주기적으로 재시작.

#### 게이트웨이가 시작되지 않음

```bash
openclaw doctor --fix
# 설정 파일의 알 수 없는 키 확인
# openclaw.json에 잘못된 키가 있으면 시작 실패
```

---

## 참고 링크

- [OpenClaw GitHub Repository](https://github.com/openclaw/openclaw)
- [공식 설치 문서](https://github.com/openclaw/openclaw/tree/main/docs/install)
- [플랫폼별 가이드](https://github.com/openclaw/openclaw/tree/main/docs/platforms)
- [게이트웨이 설정](https://github.com/openclaw/openclaw/tree/main/docs/gateway)
- [온보딩 위자드](https://github.com/openclaw/openclaw/blob/main/docs/start/wizard.md)
