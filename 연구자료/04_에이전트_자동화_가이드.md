# 오픈클로(OpenClaw) 에이전트 및 자동화 가이드

> 이 문서는 OpenClaw 공식 리포지토리의 소스코드, 문서, 최신 AI 프로바이더 가격 데이터를 기반으로 작성되었다.
> 에이전트 설정, AI 프로바이더 비교, 자동화(크론/웹훅), 고급 기능을 포괄적으로 다룬다.

---

## 목차

1. [AI 프로바이더 전체 비교](#1-ai-프로바이더-전체-비교)
2. [모델 선택 가이드](#2-모델-선택-가이드)
3. [에이전트 설정](#3-에이전트-설정)
4. [멀티에이전트](#4-멀티에이전트)
5. [모델 페일오버](#5-모델-페일오버)
6. [크론 작업](#6-크론-작업)
7. [웹훅](#7-웹훅)
8. [브라우저 제어](#8-브라우저-제어)
9. [음성 기능](#9-음성-기능)
10. [Live Canvas](#10-live-canvas)

---

## 1. AI 프로바이더 전체 비교

OpenClaw는 다양한 AI 프로바이더를 지원한다. `openclaw onboard`로 인증 후, `agents.defaults.model.primary`에 `provider/model` 형식으로 기본 모델을 지정한다.

### 1.1 공식 지원 프로바이더 목록

OpenClaw 소스코드(`models-config.providers.ts`)와 공식 문서에서 확인된 프로바이더:

| # | 프로바이더 | API 형식 | 인증 방식 | 주요 모델 |
|---|-----------|---------|----------|----------|
| 1 | **Anthropic** | anthropic-messages | API Key / OAuth | Claude Opus 4.5, Sonnet 4.5, Haiku |
| 2 | **OpenAI** | openai-completions | API Key | GPT-5.2, GPT-4o, o1, o3 |
| 3 | **Google (Gemini)** | google-antigravity | OAuth / API Key | Gemini 3 Pro, 3 Flash, 2.5 Pro |
| 4 | **OpenRouter** | openai-completions | API Key | 멀티 프로바이더 라우팅 |
| 5 | **Vercel AI Gateway** | openai-completions | API Key | 멀티 프로바이더 라우팅 |
| 6 | **Amazon Bedrock** | bedrock-converse-stream | AWS SDK (IAM) | Claude, Titan, Llama 등 |
| 7 | **GitHub Copilot** | openai-completions | GitHub Token / OAuth | Copilot Chat 모델 |
| 8 | **Venice AI (Venius)** | openai-completions | API Key | 프라이버시 우선, llama-3.3-70b |
| 9 | **Ollama** | openai-completions | 로컬 (키 불필요) | 로컬 모델 자동 검색 |
| 10 | **Moonshot AI (Kimi)** | openai-completions | API Key | Kimi K2.5 |
| 11 | **Kimi Code** | openai-completions | API Key | kimi-for-coding (reasoning) |
| 12 | **MiniMax** | openai-completions | API Key | MiniMax-M2.1, MiniMax-VL-01 |
| 13 | **Synthetic** | anthropic-messages | API Key | 자체 모델 카탈로그 |
| 14 | **Qwen Portal** | openai-completions | OAuth | Qwen Coder, Qwen Vision |
| 15 | **Xiaomi (MiMo)** | anthropic-messages | API Key | mimo-v2-flash |
| 16 | **OpenCode Zen** | openai-completions | API Key | - |
| 17 | **Z.AI** | openai-completions | API Key | - |
| 18 | **GLM** | openai-completions | API Key | - |
| 19 | **xAI (Grok)** | openai-completions | API Key | Grok-2 |
| 20 | **Groq** | openai-completions | API Key | Llama, Mixtral (초고속) |
| 21 | **Mistral** | openai-completions | API Key | Mistral Large, Medium |
| 22 | **DeepSeek** | openai-completions | API Key | DeepSeek-R1, V3 |
| 23 | **Together** | openai-completions | API Key | 다양한 오픈소스 모델 |
| 24 | **Fireworks** | openai-completions | API Key | 최적화된 오픈소스 추론 |
| 25 | **Perplexity** | openai-completions | API Key | Sonar (검색 특화) |

> OpenRouter, Vercel AI Gateway 등 라우터 프로바이더를 사용하면 수십 개 추가 모델에 접근 가능하다.

### 1.2 주요 프로바이더 가격 비교표 (2026년 1월 기준)

가격 단위: **USD / 1M 토큰**

| 프로바이더 / 모델 | 입력 | 출력 | 캐시 읽기 | 컨텍스트 윈도우 | 특징 |
|------------------|------|------|----------|----------------|------|
| **Anthropic Claude Opus 4.5** | $5.00 | $25.00 | $0.50 | 200K | 코딩 최강 (SWE-bench 80.9%) |
| **Anthropic Claude Sonnet 4.5** | $3.00 | $15.00 | $0.30 | 200K | 가성비 최고 범용 |
| **Anthropic Claude Haiku** | $0.25 | $1.25 | $0.03 | 200K | 초고속, 저비용 |
| **OpenAI GPT-5.2** | $15.00 | $75.00 | - | 128K+ | 최고 추론 성능 |
| **OpenAI GPT-4o** | $2.50 | $10.00 | $1.25 | 128K | 범용 고성능 |
| **OpenAI GPT-4o Mini** | $0.15 | $0.60 | $0.08 | 128K | 초저비용 |
| **Google Gemini 3 Pro** | ~$6.00 | ~$18.00 | - | 1M+ | 긴 컨텍스트 |
| **Google Gemini 3 Flash** | ~$0.50 | ~$3.00 | - | 1M+ | 초고속, 긴 컨텍스트 |
| **Google Gemini 2.5 Pro** | $1.25 | $5.00 | - | 1M | 가성비 우수 |
| **DeepSeek R1** | $0.55 | $2.19 | $0.14 | 64K | 추론 특화, 초저비용 |
| **DeepSeek V3** | $0.27 | $1.10 | $0.07 | 64K | 범용, 최저비용 |
| **Groq (Llama 3.3 70B)** | $0.59 | $0.79 | - | 128K | 추론 속도 최고 |
| **Mistral Large** | $2.00 | $6.00 | - | 128K | 유럽 데이터 처리 |
| **xAI Grok-2** | $2.00 | $10.00 | - | 128K | 실시간 정보 |
| **Ollama (로컬)** | 무료 | 무료 | 무료 | 모델별 상이 | 완전 무료, 오프라인 |
| **Venice AI** | 다양 | 다양 | - | 모델별 상이 | 프라이버시, 검열 없음 |
| **Moonshot Kimi K2.5** | 무료* | 무료* | - | 256K | 무료 티어 제공 |
| **MiniMax M2.1** | ~$15.00 | ~$60.00 | ~$2.00 | 200K | 비전 지원 |
| **Xiaomi MiMo V2** | 무료* | 무료* | - | 262K | 무료 티어 제공 |

> *무료 표시는 프리 티어 또는 공개된 가격 정보가 없는 경우를 의미한다.

### 1.3 설정 난이도 비교

| 프로바이더 | 설정 난이도 | 설정 방법 |
|-----------|-----------|----------|
| Anthropic | 낮음 | `openclaw onboard` → API Key 또는 OAuth |
| OpenAI | 낮음 | `openclaw onboard` → API Key |
| Google Gemini | 중간 | OAuth 인증 필요 |
| Ollama | 낮음 | 로컬 설치 후 자동 검색 |
| Amazon Bedrock | 높음 | AWS IAM 설정, 리전별 모델 활성화 |
| OpenRouter | 낮음 | API Key 하나로 다수 프로바이더 |
| Groq | 낮음 | API Key |
| DeepSeek | 낮음 | API Key |
| Venice AI | 낮음 | API Key |
| GitHub Copilot | 중간 | GitHub Token / Copilot 구독 필요 |

### 1.4 기본 모델 설정

```json5
// ~/.openclaw/openclaw.json
{
  agents: {
    defaults: {
      model: {
        primary: "anthropic/claude-opus-4-5"
      }
    }
  }
}
```

OpenRouter를 통한 멀티 프로바이더 접근:

```json5
{
  agents: {
    defaults: {
      model: {
        primary: "openrouter/anthropic/claude-opus-4-5"
      }
    }
  }
}
```

---

## 2. 모델 선택 가이드

### 2.1 용도별 추천 모델

| 용도 | 추천 1순위 | 추천 2순위 | 이유 |
|------|-----------|-----------|------|
| **일상 대화** | `anthropic/claude-sonnet-4-5` | `openai/gpt-4o` | 빠르고 자연스러운 응답 |
| **코딩/개발** | `anthropic/claude-opus-4-5` | `openai/gpt-5.2` | SWE-bench 최고 성능 |
| **긴 문서 분석** | `google/gemini-3-pro` | `google/gemini-2.5-pro` | 1M+ 토큰 컨텍스트 |
| **창작/글쓰기** | `anthropic/claude-opus-4-5` | `openai/gpt-5.2` | 창의성 + 일관성 |
| **한국어 특화** | `anthropic/claude-sonnet-4-5` | `openai/gpt-4o` | 한국어 성능 우수 |
| **비용 절약** | `deepseek/deepseek-v3` | `google/gemini-2.0-flash-lite` | 최저 비용 |
| **빠른 응답** | `groq/llama-3.3-70b` | `anthropic/claude-haiku` | 추론 속도 최고 |
| **추론/수학** | `openai/o3` | `deepseek/deepseek-r1` | 추론 체인 특화 |
| **프라이버시** | `venice/llama-3.3-70b` | `ollama/로컬모델` | 데이터 비공유 |
| **검색+답변** | `perplexity/sonar` | `xai/grok-2` | 실시간 웹 검색 |

### 2.2 비용 최적화 전략

1. **스마트 라우팅**: 간단한 질문은 Haiku/Flash, 복잡한 작업은 Opus/GPT-5.2
2. **페일오버 체인**: 비싼 모델 실패 시 저렴한 모델로 자동 전환
3. **Ollama 로컬**: 반복적/대량 작업은 무료 로컬 모델 활용
4. **캐시 활용**: Anthropic 캐시 읽기 비용은 입력의 10% 수준

```json5
// 비용 최적화 설정 예시
{
  agents: {
    defaults: {
      model: {
        primary: "anthropic/claude-sonnet-4-5",
        fallbacks: [
          "deepseek/deepseek-v3",
          "ollama/llama3.3"
        ]
      }
    }
  }
}
```

### 2.3 시나리오별 최적 조합

**개인 비서 (일상용)**
- 메인: Sonnet 4.5 (일상 대화)
- 딥워크: Opus 4.5 (복잡한 분석)
- 페일오버: GPT-4o Mini

**개발팀**
- 코드 리뷰/생성: Opus 4.5
- 문서 정리: Gemini 3 Flash (긴 문서)
- CI/CD 자동화: Haiku (빠른 응답)

**비용 민감 스타트업**
- 메인: DeepSeek V3 ($0.27/1M)
- 고품질 필요 시: Sonnet 4.5
- 대량 처리: Ollama 로컬

---

## 3. 에이전트 설정

### 3.1 에이전트란?

OpenClaw에서 **에이전트**는 독립된 AI "두뇌"이다:

- **워크스페이스** (파일, AGENTS.md, SOUL.md, USER.md, 페르소나 규칙)
- **상태 디렉토리** (`agentDir`) - 인증 프로필, 모델 레지스트리, 에이전트별 설정
- **세션 저장소** (대화 이력 + 라우팅 상태)

### 3.2 시스템 프롬프트 파일

에이전트의 성격과 행동을 정의하는 핵심 파일들:

| 파일명 | 위치 | 용도 |
|--------|------|------|
| `AGENTS.md` | 워크스페이스 루트 | 에이전트 역할, 도구 사용법, 행동 규칙 |
| `SOUL.md` | 워크스페이스 루트 | 에이전트 성격, 어조, 대화 스타일 |
| `IDENTITY.md` | 워크스페이스 루트 | 이름, 소개, 브랜딩 |
| `USER.md` | 워크스페이스 루트 | 사용자 정보, 선호도 |

```markdown
<!-- ~/.openclaw/workspace/AGENTS.md 예시 -->
# Agent Configuration

## Role
당신은 업무 생산성 전문 AI 비서입니다.

## Tools
- 일정 관리 시 캘린더 도구를 사용하세요.
- 이메일 요약 시 간결하게 3줄 이내로 작성하세요.

## Rules
- 한국어로 응답합니다.
- 중요한 일정은 반드시 확인을 받습니다.
```

```markdown
<!-- ~/.openclaw/workspace/SOUL.md 예시 -->
# Personality

## Tone
따뜻하지만 전문적. 필요할 때 유머를 섞되 과하지 않게.

## Language
한국어 기본, 기술 용어는 영어 유지.
```

### 3.3 도구 설정

에이전트에게 허용/차단할 도구를 설정할 수 있다:

```json5
{
  agents: {
    list: [
      {
        id: "safe-agent",
        workspace: "~/.openclaw/workspace-safe",
        tools: {
          allow: ["read", "exec", "sessions_list", "sessions_history"],
          deny: ["write", "edit", "apply_patch", "browser", "canvas", "cron"]
        }
      }
    ]
  }
}
```

### 3.4 컨텍스트 윈도우 & 메모리

| 모델 | 기본 컨텍스트 | 최대 컨텍스트 |
|------|-------------|-------------|
| Claude Opus 4.5 | 200K | 200K |
| GPT-5.2 | 128K+ | 128K+ |
| Gemini 3 Pro | 1M+ | 2M |
| Kimi K2.5 | 256K | 256K |
| MiMo V2 | 262K | 262K |

세션 데이터 경로:
- 세션 저장: `~/.openclaw/agents/<agentId>/sessions/`
- 인증 프로필: `~/.openclaw/agents/<agentId>/agent/auth-profiles.json`

### 3.5 샌드박스 설정

에이전트별로 Docker 기반 격리를 설정할 수 있다:

```json5
{
  agents: {
    list: [
      {
        id: "personal",
        workspace: "~/.openclaw/workspace-personal",
        sandbox: { mode: "off" }
        // 모든 도구 사용 가능
      },
      {
        id: "untrusted",
        workspace: "~/.openclaw/workspace-untrusted",
        sandbox: {
          mode: "all",
          scope: "agent",
          docker: {
            setupCommand: "apt-get update && apt-get install -y git curl"
          }
        },
        tools: {
          allow: ["read"],
          deny: ["exec", "write", "edit", "apply_patch"]
        }
      }
    ]
  }
}
```

---

## 4. 멀티에이전트

### 4.1 개념

멀티에이전트는 하나의 Gateway 프로세스에서 **여러 독립 에이전트**를 운영하는 기능이다.

- 각 에이전트는 독립된 워크스페이스, 인증, 세션을 갖는다
- 인바운드 메시지는 **바인딩(binding)** 규칙에 따라 특정 에이전트로 라우팅된다
- 여러 사람이 하나의 Gateway 서버를 공유하면서 AI "두뇌"를 분리할 수 있다

### 4.2 에이전트 추가

```bash
# 새 에이전트 추가 (대화형 위자드)
openclaw agents add work

# 에이전트 목록 + 바인딩 확인
openclaw agents list --bindings
```

### 4.3 바인딩 라우팅 규칙

바인딩은 **가장 구체적인 매칭이 우선**한다:

1. `peer` 매칭 (특정 DM/그룹/채널 ID)
2. `guildId` (Discord)
3. `teamId` (Slack)
4. `accountId` 매칭
5. 채널 레벨 매칭 (`accountId: "*"`)
6. 기본 에이전트 (fallback)

### 4.4 설정 예시: 두 WhatsApp 번호 + 두 에이전트

```json5
{
  agents: {
    list: [
      {
        id: "home",
        default: true,
        name: "Home",
        workspace: "~/.openclaw/workspace-home",
        agentDir: "~/.openclaw/agents/home/agent"
      },
      {
        id: "work",
        name: "Work",
        workspace: "~/.openclaw/workspace-work",
        agentDir: "~/.openclaw/agents/work/agent"
      }
    ]
  },
  bindings: [
    { agentId: "home", match: { channel: "whatsapp", accountId: "personal" } },
    { agentId: "work", match: { channel: "whatsapp", accountId: "biz" } },
    // 특정 그룹을 work 에이전트로 오버라이드
    {
      agentId: "work",
      match: {
        channel: "whatsapp",
        accountId: "personal",
        peer: { kind: "group", id: "1203630...@g.us" }
      }
    }
  ],
  channels: {
    whatsapp: {
      accounts: {
        personal: {},
        biz: {}
      }
    }
  }
}
```

### 4.5 채널별 에이전트 분리 (일상 + 딥워크)

```json5
{
  agents: {
    list: [
      {
        id: "chat",
        name: "Everyday",
        workspace: "~/.openclaw/workspace-chat",
        model: "anthropic/claude-sonnet-4-5"
      },
      {
        id: "opus",
        name: "Deep Work",
        workspace: "~/.openclaw/workspace-opus",
        model: "anthropic/claude-opus-4-5"
      }
    ]
  },
  bindings: [
    { agentId: "chat", match: { channel: "whatsapp" } },
    { agentId: "opus", match: { channel: "telegram" } }
  ]
}
```

### 4.6 가족 에이전트 (제한된 도구)

```json5
{
  agents: {
    list: [
      {
        id: "family",
        name: "Family",
        workspace: "~/.openclaw/workspace-family",
        identity: { name: "Family Bot" },
        groupChat: {
          mentionPatterns: ["@family", "@familybot"]
        },
        sandbox: { mode: "all", scope: "agent" },
        tools: {
          allow: ["exec", "read", "sessions_list"],
          deny: ["write", "edit", "browser", "canvas", "cron"]
        }
      }
    ]
  },
  bindings: [
    {
      agentId: "family",
      match: {
        channel: "whatsapp",
        peer: { kind: "group", id: "120363999999999999@g.us" }
      }
    }
  ]
}
```

---

## 5. 모델 페일오버

OpenClaw는 2단계 장애 대응 구조를 갖는다.

### 5.1 구조 개요

```
요청 실패
  ↓
[1단계] Auth Profile Rotation
  - 동일 프로바이더 내에서 다른 인증 프로필로 전환
  - OAuth → API Key 순서
  - 쿨다운된 프로필은 건너뜀
  ↓ (모든 프로필 실패 시)
[2단계] Model Fallback
  - agents.defaults.model.fallbacks 목록의 다음 모델로 전환
  - 마지막에 primary 모델로 복귀 시도
```

### 5.2 Auth Profile Rotation

**로테이션 순서:**
1. 명시 설정: `auth.order[provider]`
2. 설정된 프로필: `auth.profiles`
3. 저장된 프로필: `auth-profiles.json`

순서 미지정 시 라운드 로빈:
- OAuth 프로필 우선 (API Key 보다 먼저)
- `lastUsed`가 오래된 것 우선
- 쿨다운/비활성 프로필은 마지막

**세션 고정 (Session Stickiness):**
- 선택된 Auth Profile은 세션 동안 고정된다 (캐시 효율)
- `/new` 또는 `/reset` 시 재선택
- 수동 지정: `/model ...@<profileId>`

### 5.3 쿨다운 (Exponential Backoff)

인증/레이트 리밋 에러 시 쿨다운 적용:

| 횟수 | 쿨다운 시간 |
|------|-----------|
| 1회 | 1분 |
| 2회 | 5분 |
| 3회 | 25분 |
| 4회+ | 1시간 (상한) |

**빌링 비활성화** (잔액 부족 등):
- 초기 백오프: 5시간
- 배수 증가, 상한 24시간
- 24시간 동안 에러 없으면 카운터 리셋

### 5.4 Model Fallback 설정

```json5
{
  agents: {
    defaults: {
      model: {
        primary: "anthropic/claude-opus-4-5",
        fallbacks: [
          "anthropic/claude-sonnet-4-5",
          "openai/gpt-4o",
          "deepseek/deepseek-v3"
        ]
      }
    }
  }
}
```

**동작 흐름:**
1. Opus 4.5 시도 → 모든 Auth Profile 실패
2. Sonnet 4.5로 자동 전환
3. Sonnet도 실패 → GPT-4o 시도
4. GPT-4o도 실패 → DeepSeek V3 시도
5. 모두 실패 시 에러 반환

### 5.5 관련 설정 키

```json5
{
  auth: {
    profiles: { /* 메타데이터 + 라우팅 */ },
    order: { /* 프로바이더별 프로필 순서 */ },
    cooldowns: {
      billingBackoffHours: 5,
      billingMaxHours: 24,
      failureWindowHours: 24
    }
  },
  agents: {
    defaults: {
      model: {
        primary: "anthropic/claude-opus-4-5",
        fallbacks: ["anthropic/claude-sonnet-4-5"]
      },
      imageModel: {
        primary: "openai/gpt-4o",
        fallbacks: ["anthropic/claude-sonnet-4-5"]
      }
    }
  }
}
```

---

## 6. 크론 작업

OpenClaw의 크론은 Gateway 내장 스케줄러로, 정해진 시간에 에이전트를 깨우거나 작업을 실행한다.

### 6.1 핵심 개념

| 개념 | 설명 |
|------|------|
| **스케줄** | `at` (1회), `every` (반복 간격), `cron` (cron 표현식) |
| **세션 타겟** | `main` (메인 세션 이벤트) 또는 `isolated` (독립 세션) |
| **페이로드** | `systemEvent` (메인용) 또는 `agentTurn` (독립용) |
| **배달** | 선택적으로 채널(WhatsApp, Telegram 등)에 결과 전송 |

### 6.2 저장소

- 작업 저장: `~/.openclaw/cron/jobs.json`
- 실행 이력: `~/.openclaw/cron/runs/<jobId>.jsonl`

### 6.3 CLI 예시

**1회성 리마인더 (UTC, 실행 후 삭제):**

```bash
openclaw cron add \
  --name "Send reminder" \
  --at "2026-01-12T18:00:00Z" \
  --session main \
  --system-event "Reminder: submit expense report." \
  --wake now \
  --delete-after-run
```

**20분 후 리마인더:**

```bash
openclaw cron add \
  --name "Calendar check" \
  --at "20m" \
  --session main \
  --system-event "Next heartbeat: check calendar." \
  --wake now
```

**매일 아침 7시 WhatsApp 메시지 (독립 세션):**

```bash
openclaw cron add \
  --name "Morning status" \
  --cron "0 7 * * *" \
  --tz "Asia/Seoul" \
  --session isolated \
  --message "오늘 일정과 받은 메일 요약해줘." \
  --deliver \
  --channel whatsapp \
  --to "+821012345678"
```

**주간 딥 분석 (Opus 모델 + 고수준 추론):**

```bash
openclaw cron add \
  --name "Weekly analysis" \
  --cron "0 6 * * 1" \
  --tz "Asia/Seoul" \
  --session isolated \
  --message "주간 프로젝트 진행 상황 분석." \
  --model "opus" \
  --thinking high \
  --deliver \
  --channel telegram \
  --to "-1001234567890"
```

**Telegram 포럼 토픽으로 전송:**

```bash
openclaw cron add \
  --name "Nightly summary" \
  --cron "0 22 * * *" \
  --tz "Asia/Seoul" \
  --session isolated \
  --message "오늘 하루 요약." \
  --deliver \
  --channel telegram \
  --to "-1001234567890:topic:123"
```

**특정 에이전트에 크론 바인딩:**

```bash
openclaw cron add \
  --name "Ops sweep" \
  --cron "0 6 * * *" \
  --session isolated \
  --message "Check ops queue" \
  --agent ops
```

### 6.4 관리 명령어

```bash
# 수동 실행 (디버그)
openclaw cron run <jobId> --force

# 기존 작업 수정
openclaw cron edit <jobId> --message "Updated prompt" --model "opus"

# 실행 이력 조회
openclaw cron runs --id <jobId> --limit 50

# 즉시 시스템 이벤트 (작업 생성 없이)
openclaw system event --mode now --text "Next heartbeat: check battery."
```

### 6.5 설정

```json5
{
  cron: {
    enabled: true,
    store: "~/.openclaw/cron/jobs.json",
    maxConcurrentRuns: 1
  }
}
```

비활성화: `cron.enabled: false` 또는 `OPENCLAW_SKIP_CRON=1`

---

## 7. 웹훅

Gateway는 외부 시스템의 이벤트를 수신하는 HTTP 웹훅 엔드포인트를 제공한다.

### 7.1 활성화

```json5
{
  hooks: {
    enabled: true,
    token: "shared-secret",
    path: "/hooks"
  }
}
```

### 7.2 인증

모든 요청에 토큰 필요:
- `Authorization: Bearer <token>` (권장)
- `x-openclaw-token: <token>`

### 7.3 엔드포인트

#### `POST /hooks/wake` - 시스템 이벤트 깨우기

메인 세션에 시스템 이벤트를 추가하고 하트비트를 트리거한다.

```bash
curl -X POST http://127.0.0.1:18789/hooks/wake \
  -H 'Authorization: Bearer SECRET' \
  -H 'Content-Type: application/json' \
  -d '{"text":"New email received","mode":"now"}'
```

| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| `text` | string | O | 이벤트 설명 |
| `mode` | `now` / `next-heartbeat` | X | 즉시 또는 다음 하트비트 (기본: `now`) |

#### `POST /hooks/agent` - 독립 에이전트 실행

```bash
curl -X POST http://127.0.0.1:18789/hooks/agent \
  -H 'Authorization: Bearer SECRET' \
  -H 'Content-Type: application/json' \
  -d '{
    "message": "Summarize inbox",
    "name": "Email",
    "deliver": true,
    "channel": "whatsapp",
    "to": "+821012345678",
    "model": "openai/gpt-4o"
  }'
```

| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| `message` | string | O | 에이전트에게 보낼 프롬프트 |
| `name` | string | X | 훅 이름 (세션 요약 접두사) |
| `sessionKey` | string | X | 세션 키 (멀티턴 대화용) |
| `deliver` | boolean | X | 결과를 채널에 전송 (기본: `true`) |
| `channel` | string | X | 전송 채널 (`whatsapp`, `telegram`, `discord`, `slack` 등) |
| `to` | string | X | 수신자 ID |
| `model` | string | X | 모델 오버라이드 |
| `thinking` | string | X | 추론 레벨 (`low`, `medium`, `high`) |
| `timeoutSeconds` | number | X | 실행 타임아웃 |

응답: `202` (비동기 실행 시작)

### 7.4 GitHub 웹훅 연동 예시

GitHub에서 PR이 열릴 때 자동으로 코드 리뷰:

```bash
# GitHub Webhook → OpenClaw Agent
curl -X POST http://your-gateway:18789/hooks/agent \
  -H 'Authorization: Bearer SECRET' \
  -H 'Content-Type: application/json' \
  -d '{
    "message": "PR #42가 열렸습니다. octocat/my-repo에서 변경사항을 리뷰하고 요약해주세요.",
    "name": "GitHub",
    "sessionKey": "hook:github:pr-42",
    "deliver": true,
    "channel": "slack",
    "to": "channel:C01234567"
  }'
```

### 7.5 커스텀 매핑

`hooks.mappings`로 임의의 페이로드를 `wake` 또는 `agent` 액션으로 변환 가능:

- `hooks.presets: ["gmail"]` - Gmail 매핑 내장
- `hooks.transformsDir` + `transform.module` - 커스텀 JS/TS 변환 로직
- `match.source` - 페이로드 기반 라우팅

### 7.6 보안

- 엔드포인트는 루프백, Tailnet, 또는 신뢰할 수 있는 리버스 프록시 뒤에 배치
- 전용 훅 토큰 사용 (게이트웨이 인증 토큰과 분리)
- 훅 페이로드는 기본적으로 안전 경계로 감싸짐 (untrusted)

---

## 8. 브라우저 제어

OpenClaw는 Playwright 기반 **격리된 브라우저 프로필**을 제공하며, 에이전트가 웹을 자동으로 탐색하고 제어할 수 있다.

### 8.1 핵심 특징

- **격리된 프로필**: 개인 브라우저와 완전 분리된 `openclaw` 프로필
- **결정적 탭 제어**: 탭을 `targetId`로 정확히 식별
- **에이전트 액션**: 클릭, 타이핑, 드래그, 스크린샷, PDF 생성
- **멀티 프로필**: `openclaw`, `work`, `remote` 등 다수 프로필 지원

### 8.2 프로필 종류

| 프로필 | 설명 | 특징 |
|--------|------|------|
| `openclaw` | 관리형 격리 브라우저 | 확장 프로그램 불필요, 전용 CDP 포트 |
| `chrome` | 기존 Chrome 확장 릴레이 | 개인 Chrome 탭 제어, 확장 프로그램 필요 |
| `remote` | 원격 CDP 접속 | 다른 머신의 브라우저 제어 |

### 8.3 설정

```json5
{
  browser: {
    enabled: true,
    defaultProfile: "openclaw",
    color: "#FF4500",
    headless: false,
    executablePath: "/Applications/Brave Browser.app/Contents/MacOS/Brave Browser",
    profiles: {
      openclaw: { cdpPort: 18800, color: "#FF4500" },
      work: { cdpPort: 18801, color: "#0066CC" },
      remote: { cdpUrl: "http://10.0.0.42:9222", color: "#00AA00" }
    }
  }
}
```

### 8.4 CLI 기본 사용

```bash
# 브라우저 시작/상태 확인
openclaw browser --browser-profile openclaw status
openclaw browser --browser-profile openclaw start

# 페이지 열기
openclaw browser open https://example.com

# 스냅샷 (AI 분석용)
openclaw browser snapshot
openclaw browser snapshot --interactive --compact

# 스크린샷
openclaw browser screenshot
openclaw browser screenshot --full-page

# 액션 (스냅샷의 ref 사용)
openclaw browser click 12
openclaw browser type 23 "hello" --submit
openclaw browser hover 44
openclaw browser select 9 OptionA OptionB

# 네비게이션
openclaw browser navigate https://example.com
openclaw browser wait --text "Done" --timeout-ms 15000

# 파일 다운로드
openclaw browser download e12 /tmp/report.pdf

# 쿠키/상태 관리
openclaw browser cookies
openclaw browser set media dark
openclaw browser set timezone Asia/Seoul
openclaw browser set device "iPhone 14"
```

### 8.5 Browserless (호스팅 원격 CDP)

서버리스 브라우저 서비스 연동:

```json5
{
  browser: {
    enabled: true,
    defaultProfile: "browserless",
    profiles: {
      browserless: {
        cdpUrl: "https://production-sfo.browserless.io?token=<API_KEY>",
        color: "#00AA00"
      }
    }
  }
}
```

### 8.6 디버그 워크플로우

1. `openclaw browser snapshot --interactive` - 인터랙티브 요소 목록
2. `openclaw browser click <ref>` - 요소 클릭
3. 실패 시: `openclaw browser highlight <ref>` - Playwright 타겟 확인
4. 에러 조사: `openclaw browser errors --clear`
5. 깊은 디버깅: `openclaw browser trace start` → 재현 → `openclaw browser trace stop`

---

## 9. 음성 기능

### 9.1 Wake Word (음성 호출어)

OpenClaw는 **글로벌 Wake Word 목록**을 Gateway가 관리한다.

- 기본값: `["openclaw", "claude", "computer"]`
- 모든 노드/앱이 동일한 목록을 공유 (어디서 수정해도 전체 동기화)
- 각 기기는 Voice Wake 활성화/비활성화만 개별 관리

**저장소:** `~/.openclaw/settings/voicewake.json`

```json
{ "triggers": ["openclaw", "claude", "computer"], "updatedAtMs": 1730000000000 }
```

**프로토콜:**
- `voicewake.get` → 현재 트리거 목록
- `voicewake.set` → 트리거 목록 변경 → 모든 클라이언트에 `voicewake.changed` 이벤트 브로드캐스트

### 9.2 TTS (Text-to-Speech)

OpenClaw는 3가지 TTS 프로바이더를 지원한다:

| 프로바이더 | API 키 필요 | 특징 |
|-----------|-----------|------|
| **ElevenLabs** | O (`ELEVENLABS_API_KEY`) | 최고 품질, 다국어, 음성 복제 |
| **OpenAI** | O (`OPENAI_API_KEY`) | 안정적, 다양한 음성 |
| **Edge TTS** | X (무료) | 무료, Microsoft Edge 신경 음성 |

기본 동작: TTS는 꺼져 있으며, 설정으로 활성화한다.

### 9.3 TTS 설정 예시

**ElevenLabs 기본:**

```json5
{
  messages: {
    tts: {
      auto: "always",
      provider: "elevenlabs",
      elevenlabs: {
        voiceId: "voice_id",
        modelId: "eleven_multilingual_v2",
        voiceSettings: {
          stability: 0.5,
          similarityBoost: 0.75,
          speed: 1.0
        }
      }
    }
  }
}
```

**무료 Edge TTS (API 키 불필요):**

```json5
{
  messages: {
    tts: {
      auto: "always",
      provider: "edge",
      edge: {
        enabled: true,
        voice: "ko-KR-SunHiNeural",  // 한국어 음성
        lang: "ko-KR",
        outputFormat: "audio-24khz-48kbitrate-mono-mp3",
        rate: "+10%"
      }
    }
  }
}
```

**OpenAI primary + ElevenLabs fallback:**

```json5
{
  messages: {
    tts: {
      auto: "always",
      provider: "openai",
      openai: {
        model: "gpt-4o-mini-tts",
        voice: "alloy"
      },
      elevenlabs: {
        voiceId: "voice_id"
      }
    }
  }
}
```

### 9.4 TTS 모드

| 모드 | 설명 |
|------|------|
| `off` | TTS 비활성 (기본값) |
| `always` | 모든 응답을 음성으로 변환 |
| `inbound` | 음성 메시지를 받았을 때만 음성 응답 |
| `tagged` | `[[tts]]` 태그가 포함된 응답만 음성 변환 |

### 9.5 슬래시 커맨드

```
/tts always          # 항상 음성 응답
/tts off             # 음성 끄기
/tts inbound         # 음성 입력 시에만
/tts provider openai # 프로바이더 변경
/tts limit 2000      # 요약 기준 길이
/tts summary off     # 자동 요약 끄기
/tts audio Hello     # 1회성 음성 생성
```

### 9.6 모델 구동 TTS 오버라이드

모델이 응답 내에서 TTS 지시를 내릴 수 있다:

```
응답 텍스트입니다.

[[tts:provider=elevenlabs voiceId=pMsXgVXv3BLzUgSXRplE speed=1.1]]
[[tts:text]](웃음) 노래를 한번 더 읽어볼게요.[[/tts:text]]
```

### 9.7 출력 형식

| 채널 | 형식 | 이유 |
|------|------|------|
| Telegram | Opus (48kHz/64kbps) | 둥근 음성 메시지 버블용 |
| 기타 채널 | MP3 (44.1kHz/128kbps) | 범용 호환 |

---

## 10. Live Canvas

macOS 앱 전용 기능으로, 에이전트가 제어하는 **시각적 워크스페이스**이다.

### 10.1 개요

- `WKWebView` 기반 패널로 HTML/CSS/JS, A2UI 렌더링
- 커스텀 URL 스킴: `openclaw-canvas://<session>/<path>`
- 파일 변경 시 자동 리로드
- Settings > Allow Canvas 에서 활성화/비활성화

### 10.2 저장소

```
~/Library/Application Support/OpenClaw/canvas/<session>/...
```

URL 매핑:
- `openclaw-canvas://main/` → `index.html`
- `openclaw-canvas://main/assets/app.css` → `assets/app.css`
- `openclaw-canvas://main/widgets/todo/` → `widgets/todo/index.html`

### 10.3 에이전트 API

Gateway WebSocket을 통해 Canvas를 제어:

```bash
# 패널 표시
openclaw nodes canvas present --node <id>

# 페이지 이동
openclaw nodes canvas navigate --node <id> --url "/"

# JavaScript 실행
openclaw nodes canvas eval --node <id> --js "document.title"

# 스냅샷 캡처
openclaw nodes canvas snapshot --node <id>
```

### 10.4 A2UI (Agent-to-UI) 프레임워크

A2UI는 에이전트가 UI를 생성하고 제어하는 프레임워크이다.

**기본 A2UI 호스트 URL:**
```
http://<gateway-host>:18793/__openclaw__/a2ui/
```

**지원 명령 (v0.8):**

| 명령 | 설명 |
|------|------|
| `beginRendering` | 렌더링 시작 |
| `surfaceUpdate` | 서피스(UI 화면) 업데이트 |
| `dataModelUpdate` | 데이터 모델 업데이트 |
| `deleteSurface` | 서피스 삭제 |

**A2UI 예시:**

```bash
# JSONL 파일로 A2UI 메시지 전송
cat > /tmp/a2ui.jsonl <<'EOF'
{"surfaceUpdate":{"surfaceId":"main","components":[{"id":"root","component":{"Column":{"children":{"explicitList":["title","content"]}}}},{"id":"title","component":{"Text":{"text":{"literalString":"Hello Canvas"},"usageHint":"h1"}}},{"id":"content","component":{"Text":{"text":{"literalString":"A2UI로 만든 화면입니다."},"usageHint":"body"}}}]}}
{"beginRendering":{"surfaceId":"main","root":"root"}}
EOF

openclaw nodes canvas a2ui push --jsonl /tmp/a2ui.jsonl --node <id>
```

**간단한 텍스트 전송:**

```bash
openclaw nodes canvas a2ui push --node <id> --text "Hello from A2UI"
```

### 10.5 Canvas에서 에이전트 실행 트리거

Canvas 내 JavaScript에서 딥 링크로 에이전트를 호출할 수 있다:

```js
// Canvas 내 JS 코드
window.location.href = "openclaw://agent?message=Review%20this%20design";
```

### 10.6 보안

- 커스텀 스킴은 디렉토리 트래버설을 차단하며, 세션 루트 내 파일만 접근 가능
- 외부 `http(s)` URL은 명시적 네비게이션에서만 허용
- 로컬 Canvas 콘텐츠는 루프백 서버 없이 커스텀 스킴으로 제공

---

## 부록: 빠른 참조

### 주요 경로 요약

| 항목 | 경로 |
|------|------|
| 메인 설정 | `~/.openclaw/openclaw.json` |
| 워크스페이스 | `~/.openclaw/workspace` (또는 `workspace-<agentId>`) |
| 에이전트 상태 | `~/.openclaw/agents/<agentId>/agent/` |
| 인증 프로필 | `~/.openclaw/agents/<agentId>/agent/auth-profiles.json` |
| 세션 | `~/.openclaw/agents/<agentId>/sessions/` |
| 크론 작업 | `~/.openclaw/cron/jobs.json` |
| 크론 이력 | `~/.openclaw/cron/runs/<jobId>.jsonl` |
| Wake Word | `~/.openclaw/settings/voicewake.json` |
| TTS 설정 | `~/.openclaw/settings/tts.json` |
| Canvas 데이터 | `~/Library/Application Support/OpenClaw/canvas/<session>/` |

### 핵심 CLI 명령어

```bash
# 에이전트 관리
openclaw agents add <name>
openclaw agents list --bindings

# 모델 관리
openclaw config set agents.defaults.model.primary "anthropic/claude-opus-4-5"

# 크론
openclaw cron add --name "..." --cron "0 7 * * *" --session isolated --message "..."
openclaw cron list
openclaw cron run <jobId> --force

# 브라우저
openclaw browser start
openclaw browser snapshot --interactive
openclaw browser click <ref>

# TTS
/tts always
/tts provider openai

# 시스템 이벤트
openclaw system event --mode now --text "Check something"
```
