# 09. OpenClaw 보안 및 셀프호스팅 심화 가이드 (v3.0)

본 문서는 OpenClaw를 직접 호스팅(Self-Hosting)할 때 필수적인 보안 설정, 프라이버시 보호, 인프라 운영 방법을 다룬다. 개인 데이터를 다루는 AI 비서인 만큼 철저한 보안이 요구된다.

> **경고**: 이 가이드의 모든 설정은 "기본적으로 모든 것을 차단하고 필요한 것만 허용(Deny by Default)"하는 원칙을 따른다.

---

## 목차

1. [위협 모델링 (Threat Modeling)](#1-위협-모델링-threat-modeling)
2. [보안 필수 체크리스트](#2-보안-필수-체크리스트)
3. [API 키 및 시크릿 관리](#3-api-키-및-시크릿-관리)
4. [네트워크 및 접근 제어](#4-네트워크-및-접근-제어)
5. [SSH 하드닝 (SSH Hardening)](#5-ssh-하드닝-ssh-hardening)
6. [Docker 보안 하드닝](#6-docker-보안-하드닝)
7. [보안 감사 도구 및 자동화](#7-보안-감사-도구-및-자동화)
8. [데이터 프라이버시 및 로컬 전용 모드](#8-데이터-프라이버시-및-로컬-전용-모드)
9. [법적 준수 가이드 (Compliance)](#9-법적-준수-가이드-compliance)
10. [인프라별 상세 셀프호스팅 가이드](#10-인프라별-상세-셀프호스팅-가이드)
11. [백업 암호화 및 재해 복구](#11-백업-암호화-및-재해-복구)
12. [모니터링 및 로깅](#12-모니터링-및-로깅)
13. [업데이트 및 패치 관리](#13-업데이트-및-패치-관리)
14. [실전 공격 시나리오와 대응](#14-실전-공격-시나리오와-대응)
15. [참고 자료 (References)](#참고-자료-references)

---

## 1. 위협 모델링 (Threat Modeling)

보안 대책을 세우기 전, OpenClaw 운영 시 발생할 수 있는 공격 벡터를 이해해야 한다. 2025-2026년 기준 셀프호스팅 AI 도구에 대한 주요 위협은 다음과 같다.

### 1.1 공격 벡터 종합 분석

| 공격 벡터 (Attack Vector) | 위험도 | 시나리오 | 방어 대책 (Mitigation) |
| :--- | :--- | :--- | :--- |
| **API 키 탈취** | Critical | `.env`가 Git에 노출되거나 컨테이너 해킹으로 `OPENCLAW_GATEWAY_TOKEN` 및 LLM 키 유출 | `.env` 권한 제한 (`600`), [1Password CLI](https://developer.1password.com/docs/cli) 사용, Docker Secrets 활용 |
| **Gateway 포트 노출** | Critical | `18789` 포트가 공용 인터넷에 열려 공격자가 봇 제어권 탈취 | Reverse Proxy ([Nginx](https://nginx.org/en/docs/), [Traefik](https://doc.traefik.io/traefik/)) 사용, VPN ([Tailscale](https://tailscale.com), [WireGuard](https://www.wireguard.com)) 전용 접속 |
| **세션 하이재킹** | High | 메신저(텔레그램, 디스코드) 토큰이 유출되어 공격자가 봇 행세 | 채널별 `allowlist` (허용 사용자) 설정 필수, 주기적 토큰 교체 |
| **프롬프트 인젝션** | High | 악의적 사용자가 AI를 속여 시스템 명령 실행 또는 데이터 유출 유도 | 샌드박스 환경 실행 ([Docker](https://docs.docker.com/engine/security/)), 민감 파일 시스템 접근 차단, 도구 허용 목록 제한 |
| **의존성 취약점 (Supply Chain)** | Medium | Node.js 패키지나 Docker 이미지의 취약점을 통한 공격 | `npm audit`, [Trivy](https://trivy.dev) 스캔, 자동 업데이트 ([Watchtower](https://containrrr.dev/watchtower/)) |
| **Docker Daemon Socket 노출** | Critical | `/var/run/docker.sock`가 컨테이너에 마운트되어 호스트 root 접근 | 소켓 마운트 금지, Docker-in-Docker 대신 Rootless Docker 사용 |
| **메모리 포이즈닝** | Medium | 세션 데이터 조작으로 에이전트 행동 변조 | 세션 파일 무결성 검증, 세션 디렉토리 접근 권한 제한 |
| **네트워크 측면 이동** | Medium | 컨테이너 간 네트워크 격리 실패로 인접 서비스 침투 | Docker network 격리, 컨테이너 간 통신 최소화 |

### 1.2 위협 모델 다이어그램

```
[인터넷]
    |
    v
[방화벽/UFW] ── 허용: 80, 443만
    |
    v
[Reverse Proxy (Nginx/Traefik)] ── SSL 종단, Rate Limiting
    |
    v
[VPN 터널 (Tailscale/WireGuard)] ── 선택적 추가 보안 레이어
    |
    v
[OpenClaw Gateway :18789] ── 루프백 바인딩 권장
    |
    ├── [에이전트 A] ── 샌드박스 (Docker)
    ├── [에이전트 B] ── 도구 제한 (allowlist)
    └── [세션 저장소] ── 암호화, 접근 제한
         └── ~/.openclaw/sessions/
```

### 1.3 STRIDE 위협 분류

[OWASP Top 10](https://owasp.org/www-project-top-ten/) 및 STRIDE 모델을 기반으로 OpenClaw에 적용 가능한 위협을 분류한다.

| STRIDE 분류 | OpenClaw 적용 | 대응 |
| :--- | :--- | :--- |
| **S**poofing (위장) | 메신저 토큰 탈취, Gateway 토큰 위조 | 강력한 토큰 생성, 주기적 교체 |
| **T**ampering (변조) | 설정 파일 조작, 세션 데이터 변조 | 파일 권한 제한, 무결성 체크 |
| **R**epudiation (부인) | 관리 작업 로그 부재 | 모든 접근 로깅, 감사 로그 보관 |
| **I**nformation Disclosure (정보 누출) | API 키 노출, 대화 로그 유출 | 암호화, 접근 제어, 최소 권한 원칙 |
| **D**enial of Service (서비스 거부) | Gateway에 대량 요청, 리소스 고갈 | Rate Limiting, 리소스 제한 |
| **E**levation of Privilege (권한 상승) | 컨테이너 탈출, root 실행 | Non-root 실행, 최소 권한 |

---

## 2. 보안 필수 체크리스트

### 2.1 즉시 적용 체크리스트

| 중요도 | 항목 | 설명 | 확인 명령 / 비고 |
| :--- | :--- | :--- | :--- |
| **필수** | **API 키 관리** | `.env` 파일 권한 설정 및 Git 업로드 금지 | `chmod 600 .env && echo ".env" >> .gitignore` |
| **필수** | **외부 노출 차단** | Gateway 포트(18789) 공용 인터넷 직접 노출 금지 | `--bind loopback` 옵션 사용 |
| **필수** | **인증 설정** | `OPENCLAW_GATEWAY_TOKEN` 설정 필수 | `openssl rand -hex 32` 로 생성 |
| **필수** | **Node.js v22+** | 보안 패치가 적용된 최신 LTS 사용 | `node --version` |
| **필수** | **채널 Allowlist** | 각 채널(WhatsApp, Telegram 등)에 허용 사용자 목록 설정 | `config.json`의 allowlist 확인 |
| **권장** | **Docker 하드닝** | Non-root 유저 실행, 리소스 제한, Read-only FS | [Docker Security](https://docs.docker.com/engine/security/) 참조 |
| **권장** | **HTTPS 적용** | SSL 인증서 적용 | [Let's Encrypt](https://letsencrypt.org) / [Certbot](https://certbot.eff.org) |
| **권장** | **샌드박스 모드** | 에이전트별 Docker 기반 격리 적용 | `sandbox.mode: "all"` 설정 |
| **선택** | **VPN 사용** | 외부 접속 시 Tailscale/WireGuard 권장 | 포트 포워딩 대체 |
| **선택** | **보안 감사** | 정기적인 취약점 스캔 | Trivy, [CrowdSec](https://www.crowdsec.net) |
| **선택** | **백업 암호화** | GPG 또는 rclone crypt로 백업 암호화 | 자동 스크립트 설정 |

### 2.2 보안 성숙도 레벨

| 레벨 | 대상 | 필수 항목 |
| :--- | :--- | :--- |
| **Level 1 (기본)** | 개인 사용자 | API 키 보호, Gateway 토큰, 루프백 바인딩 |
| **Level 2 (권장)** | 소규모 팀 | HTTPS, VPN, Docker 하드닝, 채널 Allowlist |
| **Level 3 (엔터프라이즈)** | 기업/조직 | 보안 감사 자동화, SIEM 연동, 법적 준수, 침입 탐지 |

---

## 3. API 키 및 시크릿 관리

### 3.1 환경변수 보안

OpenClaw는 다양한 API 프로바이더 키를 사용한다. 이 키들의 안전한 관리가 보안의 핵심이다.

```bash
# .env 파일 생성 및 권한 설정
cat > ~/.openclaw/.env << 'EOF'
# OpenClaw Gateway 인증 토큰 (필수)
OPENCLAW_GATEWAY_TOKEN=your_secure_random_token_here

# AI 프로바이더 키
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-...

# 메신저 토큰
TELEGRAM_BOT_TOKEN=...
DISCORD_BOT_TOKEN=...
EOF

# 권한 제한 (소유자만 읽기/쓰기)
chmod 600 ~/.openclaw/.env

# .gitignore에 추가 (필수)
echo ".env" >> .gitignore
echo ".env.*" >> .gitignore
echo "credentials/" >> .gitignore
```

### 3.2 1Password CLI 연동

[1Password CLI](https://developer.1password.com/docs/cli)를 사용하면 API 키를 파일에 저장하지 않고 런타임에 주입할 수 있다.

```bash
# 1Password CLI로 시크릿 참조
export OPENCLAW_GATEWAY_TOKEN=$(op read "op://Private/OpenClaw/gateway-token")
export ANTHROPIC_API_KEY=$(op read "op://Private/Anthropic/api-key")
export OPENAI_API_KEY=$(op read "op://Private/OpenAI/api-key")

# 또는 .env 파일에 op:// 참조 사용
# op run --env-file=.env -- openclaw gateway run
```

**1Password 환경 파일 (`.env.1password`):**

```bash
OPENCLAW_GATEWAY_TOKEN=op://Private/OpenClaw/gateway-token
ANTHROPIC_API_KEY=op://Private/Anthropic/api-key
OPENAI_API_KEY=op://Private/OpenAI/api-key
TELEGRAM_BOT_TOKEN=op://Private/Telegram/bot-token
```

```bash
# 1Password로 환경변수 주입 후 실행
op run --env-file=.env.1password -- openclaw gateway run --bind loopback --port 18789
```

### 3.3 HashiCorp Vault (엔터프라이즈급)

대규모 배포 시 [HashiCorp Vault](https://www.vaultproject.io)를 사용하여 중앙 집중식 시크릿 관리를 할 수 있다.

```bash
# Vault에 시크릿 저장
vault kv put secret/openclaw \
  gateway_token="$(openssl rand -hex 32)" \
  anthropic_key="sk-ant-..." \
  openai_key="sk-..."

# Vault에서 시크릿 읽기
export OPENCLAW_GATEWAY_TOKEN=$(vault kv get -field=gateway_token secret/openclaw)
export ANTHROPIC_API_KEY=$(vault kv get -field=anthropic_key secret/openclaw)
```

### 3.4 Docker Secrets 활용

Docker Swarm 또는 Compose에서 시크릿을 안전하게 전달하는 방법이다.

```yaml
# docker-compose.yml
version: '3.8'
services:
  openclaw:
    image: openclaw/openclaw:latest
    secrets:
      - gateway_token
      - anthropic_key
    environment:
      OPENCLAW_GATEWAY_TOKEN_FILE: /run/secrets/gateway_token
      ANTHROPIC_API_KEY_FILE: /run/secrets/anthropic_key

secrets:
  gateway_token:
    file: ./secrets/gateway_token.txt
  anthropic_key:
    file: ./secrets/anthropic_key.txt
```

### 3.5 시크릿 로테이션 정책

| 시크릿 유형 | 교체 주기 | 방법 |
| :--- | :--- | :--- |
| Gateway Token | 90일 | `openssl rand -hex 32` 재생성 |
| AI Provider API Key | 180일 | 프로바이더 대시보드에서 재발급 |
| 메신저 Bot Token | 사고 발생 시 즉시 | 각 플랫폼에서 재발급 |
| SSH 키 | 365일 | `ssh-keygen -t ed25519` 재생성 |
| SSL 인증서 | 자동 (Let's Encrypt 90일) | Certbot 자동 갱신 |

---

## 4. 네트워크 및 접근 제어

### 4.1 Reverse Proxy 설정 (Nginx)

공용 인터넷에 노출해야 한다면 [Nginx](https://nginx.org/en/docs/)를 앞단에 두고 HTTPS와 추가 인증을 적용한다.

**전체 Nginx 설정 예시 (`/etc/nginx/sites-available/openclaw`):**

```nginx
# HTTP → HTTPS 리다이렉트
server {
    listen 80;
    server_name ai.example.com;
    return 301 https://$server_name$request_uri;
}

# HTTPS 메인 설정
server {
    listen 443 ssl http2;
    server_name ai.example.com;

    # SSL 설정 (Let's Encrypt via Certbot)
    ssl_certificate /etc/letsencrypt/live/ai.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/ai.example.com/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    # 최신 TLS만 허용
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    # 보안 헤더
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
    add_header Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'" always;

    # Rate Limiting (DDoS 방어)
    limit_req_zone $binary_remote_addr zone=openclaw_limit:10m rate=10r/s;
    limit_req zone=openclaw_limit burst=20 nodelay;

    # 요청 크기 제한
    client_max_body_size 10M;

    # Gateway 프록시
    location / {
        proxy_pass http://127.0.0.1:18789;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;

        # 타임아웃 (AI 응답 대기용)
        proxy_read_timeout 300s;
        proxy_send_timeout 300s;

        # IP 화이트리스트 (선택)
        # allow 192.168.1.0/24;
        # allow 10.0.0.0/8;  # Tailscale 대역
        # deny all;
    }

    # Webhook 엔드포인트
    location /hooks/ {
        proxy_pass http://127.0.0.1:18789;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # Webhook 전용 Rate Limiting
        limit_req zone=openclaw_limit burst=5 nodelay;
    }

    # 상태 확인 엔드포인트 (내부 전용)
    location /health {
        proxy_pass http://127.0.0.1:18789;
        allow 127.0.0.1;
        allow 10.0.0.0/8;
        deny all;
    }

    # 접근 로그
    access_log /var/log/nginx/openclaw_access.log;
    error_log /var/log/nginx/openclaw_error.log warn;
}
```

**SSL 인증서 발급 ([Certbot](https://certbot.eff.org)):**

```bash
# Certbot 설치 및 인증서 발급
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d ai.example.com

# 자동 갱신 확인
sudo certbot renew --dry-run

# cron으로 자동 갱신 설정
echo "0 3 * * * certbot renew --quiet --post-hook 'systemctl reload nginx'" | sudo crontab -
```

### 4.2 Reverse Proxy 설정 (Traefik)

Docker 환경에서는 [Traefik](https://doc.traefik.io/traefik/)이 더 유연하다.

```yaml
# docker-compose.yml (Traefik + OpenClaw)
version: '3.8'

services:
  traefik:
    image: traefik:v3.2
    command:
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
      - "--entrypoints.websecure.address=:443"
      - "--certificatesresolvers.myresolver.acme.tlschallenge=true"
      - "--certificatesresolvers.myresolver.acme.email=admin@example.com"
      - "--certificatesresolvers.myresolver.acme.storage=/acme.json"
      - "--entrypoints.web.http.redirections.entrypoint.to=websecure"
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./acme.json:/acme.json
    networks:
      - proxy

  openclaw-gateway:
    image: openclaw/openclaw:latest
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.openclaw.rule=Host(`ai.example.com`)"
      - "traefik.http.routers.openclaw.entrypoints=websecure"
      - "traefik.http.routers.openclaw.tls.certresolver=myresolver"
      - "traefik.http.services.openclaw.loadbalancer.server.port=18789"
      # Rate Limiting 미들웨어
      - "traefik.http.middlewares.ratelimit.ratelimit.average=10"
      - "traefik.http.middlewares.ratelimit.ratelimit.burst=20"
      - "traefik.http.routers.openclaw.middlewares=ratelimit"
    environment:
      - OPENCLAW_GATEWAY_TOKEN=${GATEWAY_TOKEN}
    networks:
      - proxy
      - internal

networks:
  proxy:
    external: true
  internal:
    driver: bridge
    internal: true  # 외부 접근 불가
```

### 4.3 VPN 설정

#### Tailscale (추천 - 간편 설정)

[Tailscale](https://tailscale.com)은 WireGuard 기반의 간편 VPN이다. 포트 포워딩 없이 안전한 원격 접속이 가능하다.

```bash
# Tailscale 설치 (Linux)
curl -fsSL https://tailscale.com/install.sh | sh
sudo tailscale up

# Tailscale IP 확인
tailscale ip -4

# OpenClaw Gateway를 Tailscale 네트워크에서만 접근 가능하게 설정
openclaw gateway run --bind 100.x.x.x --port 18789
```

#### WireGuard (직접 설정)

[WireGuard](https://www.wireguard.com)로 직접 VPN 터널을 구성하는 방법이다.

```bash
# WireGuard 설치
sudo apt install wireguard

# 키 생성
wg genkey | tee privatekey | wg pubkey > publickey

# /etc/wireguard/wg0.conf (서버)
cat > /etc/wireguard/wg0.conf << 'EOF'
[Interface]
PrivateKey = <서버_개인키>
Address = 10.0.0.1/24
ListenPort = 51820

[Peer]
PublicKey = <클라이언트_공개키>
AllowedIPs = 10.0.0.2/32
EOF

# WireGuard 시작
sudo wg-quick up wg0
sudo systemctl enable wg-quick@wg0
```

### 4.4 방화벽 설정 (UFW)

```bash
# UFW 기본 설정
sudo ufw default deny incoming
sudo ufw default allow outgoing

# SSH 허용 (변경된 포트 사용)
sudo ufw allow 2222/tcp comment 'SSH'

# HTTP/HTTPS 허용 (Reverse Proxy용)
sudo ufw allow 80/tcp comment 'HTTP redirect'
sudo ufw allow 443/tcp comment 'HTTPS'

# WireGuard 허용 (VPN 사용 시)
sudo ufw allow 51820/udp comment 'WireGuard'

# OpenClaw Gateway 포트는 허용하지 않음 (루프백만 사용)
# 절대 ufw allow 18789 하지 않는다!

# 방화벽 활성화
sudo ufw enable
sudo ufw status verbose
```

---

## 5. SSH 하드닝 (SSH Hardening)

VPS나 원격 서버 사용 시 SSH 보안은 가장 기본적이면서 중요한 보안 조치이다.

### 5.1 SSH 키 기반 인증 설정

```bash
# 클라이언트에서 Ed25519 키 생성 (가장 안전한 알고리즘)
ssh-keygen -t ed25519 -C "openclaw-server" -f ~/.ssh/openclaw_ed25519

# 공개키를 서버에 전송
ssh-copy-id -i ~/.ssh/openclaw_ed25519.pub user@server-ip

# SSH 클라이언트 설정 (~/.ssh/config)
cat >> ~/.ssh/config << 'EOF'
Host openclaw-server
    HostName your-server-ip
    User openclaw
    Port 2222
    IdentityFile ~/.ssh/openclaw_ed25519
    IdentitiesOnly yes
    ServerAliveInterval 60
    ServerAliveCountMax 3
EOF
```

### 5.2 SSH 서버 하드닝

`/etc/ssh/sshd_config` 수정:

```bash
# === SSH 하드닝 설정 ===

# 포트 변경 (기본 22 대신)
Port 2222

# 프로토콜 2만 사용
Protocol 2

# Root 로그인 금지
PermitRootLogin no

# 비밀번호 인증 비활성화 (키만 허용)
PasswordAuthentication no
ChallengeResponseAuthentication no
UsePAM yes

# 공개키 인증만 허용
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys

# 빈 비밀번호 금지
PermitEmptyPasswords no

# 로그인 시도 제한
MaxAuthTries 3
MaxStartups 3:50:10
LoginGraceTime 30

# 허용 사용자 제한
AllowUsers openclaw

# X11 포워딩 비활성화
X11Forwarding no

# Agent 포워딩 비활성화
AllowAgentForwarding no

# TCP 포워딩 제한
AllowTcpForwarding local

# 배너 설정 (법적 경고문)
Banner /etc/ssh/banner.txt

# 강력한 암호화 알고리즘만 허용
KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com

# 유휴 세션 타임아웃
ClientAliveInterval 300
ClientAliveCountMax 2
```

```bash
# 설정 적용
sudo sshd -t  # 문법 검증
sudo systemctl restart sshd
```

### 5.3 Fail2Ban 설정

[Fail2Ban](https://github.com/fail2ban/fail2ban)으로 무차별 대입 공격(Brute Force)을 방어한다.

```bash
# 설치
sudo apt install fail2ban

# 커스텀 설정 생성
sudo cat > /etc/fail2ban/jail.local << 'EOF'
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 3
banaction = ufw

# 이메일 알림 (선택)
# destemail = admin@example.com
# action = %(action_mwl)s

[sshd]
enabled = true
port = 2222
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 86400

# Nginx 관련 jail
[nginx-http-auth]
enabled = true
filter = nginx-http-auth
logpath = /var/log/nginx/openclaw_error.log
maxretry = 5

[nginx-limit-req]
enabled = true
filter = nginx-limit-req
logpath = /var/log/nginx/openclaw_error.log
maxretry = 10
findtime = 60
bantime = 7200
EOF

# Fail2Ban 시작
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

# 차단 현황 확인
sudo fail2ban-client status sshd
```

### 5.4 2단계 인증 (2FA) 추가

SSH에 Google Authenticator를 추가하여 2단계 인증을 적용할 수 있다.

```bash
# Google Authenticator PAM 설치
sudo apt install libpam-google-authenticator

# 사용자별 설정
google-authenticator

# /etc/pam.d/sshd에 추가
echo "auth required pam_google_authenticator.so" | sudo tee -a /etc/pam.d/sshd

# sshd_config 수정
# ChallengeResponseAuthentication yes
# AuthenticationMethods publickey,keyboard-interactive
```

---

## 6. Docker 보안 하드닝

[Docker 공식 보안 문서](https://docs.docker.com/engine/security/)를 기반으로 한 OpenClaw 컨테이너 보안 설정이다. 2025-2026년 기준, 컨테이너의 58%가 여전히 root로 실행되고 있어 이 부분의 주의가 필요하다.

### 6.1 보안 강화된 Dockerfile

```dockerfile
# 멀티스테이지 빌드로 최소 이미지 생성
FROM node:22-alpine AS builder
WORKDIR /app
COPY package.json pnpm-lock.yaml ./
RUN corepack enable && pnpm install --frozen-lockfile
COPY . .
RUN pnpm build

# 프로덕션 이미지
FROM node:22-alpine AS production
LABEL maintainer="openclaw"
LABEL org.opencontainers.image.source="https://github.com/openclaw/openclaw"

# 보안: non-root 사용자 생성
RUN addgroup -g 1001 -S openclaw && \
    adduser -S openclaw -u 1001 -G openclaw

# 필수 패키지만 설치
RUN apk add --no-cache tini dumb-init

# 빌드 산출물 복사
COPY --from=builder --chown=openclaw:openclaw /app/dist /app/dist
COPY --from=builder --chown=openclaw:openclaw /app/node_modules /app/node_modules
COPY --from=builder --chown=openclaw:openclaw /app/package.json /app/

# 작업 디렉토리
WORKDIR /app

# non-root 사용자로 전환
USER openclaw

# 헬스체크
HEALTHCHECK --interval=30s --timeout=10s --start-period=10s --retries=3 \
  CMD node -e "require('http').get('http://localhost:18789/health', (r) => { process.exit(r.statusCode === 200 ? 0 : 1) })" || exit 1

# tini를 init 프로세스로 사용 (좀비 프로세스 방지)
ENTRYPOINT ["/sbin/tini", "--"]
CMD ["node", "dist/index.js", "gateway", "run", "--bind", "0.0.0.0", "--port", "18789"]
```

### 6.2 보안 강화된 docker-compose.yml

```yaml
version: '3.8'

services:
  openclaw:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: openclaw-gateway
    restart: unless-stopped

    # 보안: non-root 실행
    user: "1001:1001"

    # 보안: 읽기 전용 파일시스템
    read_only: true
    tmpfs:
      - /tmp:size=100M,noexec,nosuid

    # 보안: Linux Capabilities 제한
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE  # 포트 바인딩만 허용

    # 보안: 권한 상승 금지
    security_opt:
      - no-new-privileges:true

    # 리소스 제한 (DoS 방어)
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '2.0'
        reservations:
          memory: 256M
          cpus: '0.5'

    # 네트워크 격리
    networks:
      - internal

    # 볼륨 (최소 필요분만)
    volumes:
      - openclaw-data:/home/openclaw/.openclaw:rw
      - openclaw-sessions:/home/openclaw/.openclaw/sessions:rw

    # 환경변수
    env_file:
      - .env

    # 포트 (루프백만 노출)
    ports:
      - "127.0.0.1:18789:18789"

    # PID 네임스페이스 격리
    pid: "host"  # 제거하여 격리 (기본값은 host)

    # 로깅
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  openclaw-data:
  openclaw-sessions:

networks:
  internal:
    driver: bridge
    internal: true  # 외부 인터넷 접근 차단 (필요시 해제)
```

### 6.3 Docker Daemon 보안 설정

`/etc/docker/daemon.json`:

```json
{
  "icc": false,
  "userns-remap": "default",
  "no-new-privileges": true,
  "live-restore": true,
  "userland-proxy": false,
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  },
  "storage-driver": "overlay2",
  "default-ulimits": {
    "nofile": {
      "Name": "nofile",
      "Hard": 65536,
      "Soft": 32768
    }
  }
}
```

### 6.4 컨테이너 네트워크 보안

```bash
# 격리된 네트워크 생성
docker network create --internal openclaw-internal

# 외부 통신이 필요한 컨테이너만 별도 네트워크
docker network create openclaw-external

# 네트워크 간 통신 확인
docker network inspect openclaw-internal
```

---

## 7. 보안 감사 도구 및 자동화

지속적인 보안 관리를 위해 자동화 도구를 사용한다.

### 7.1 의존성 취약점 검사

[npm audit](https://docs.npmjs.com/cli/v10/commands/npm-audit)를 사용한 정기 검사이다.

```bash
# 프로젝트 루트에서 실행
npm audit
# 또는
pnpm audit

# 자동 수정 가능한 취약점 수정
npm audit fix

# 심각한 취약점만 필터링
npm audit --audit-level=high

# CI/CD 파이프라인에 통합
npm audit --audit-level=critical || exit 1
```

### 7.2 컨테이너 이미지 스캔 (Trivy)

[Trivy](https://trivy.dev)는 컨테이너 이미지, 파일시스템, Git 리포지토리의 취약점을 스캔하는 도구이다.

```bash
# Trivy 설치
brew install aquasecurity/trivy/trivy  # macOS
# 또는
sudo apt install trivy  # Linux

# Docker 이미지 스캔
trivy image openclaw/openclaw:latest

# 높은 심각도 이상만 표시
trivy image --severity HIGH,CRITICAL openclaw/openclaw:latest

# SBOM (Software Bill of Materials) 생성
trivy image --format cyclonedx --output sbom.json openclaw/openclaw:latest

# 파일시스템 스캔
trivy fs --security-checks vuln,secret,config /path/to/openclaw

# CI/CD 통합 (취약점 발견 시 빌드 실패)
trivy image --exit-code 1 --severity CRITICAL openclaw/openclaw:latest
```

### 7.3 침입 탐지 (CrowdSec)

[CrowdSec](https://www.crowdsec.net)은 로그를 분석하여 공격 패턴을 탐지하고 차단하는 협업형 보안 도구이다.

```bash
# CrowdSec 설치
curl -s https://packagecloud.io/install/repositories/crowdsec/crowdsec/script.deb.sh | sudo bash
sudo apt install crowdsec crowdsec-firewall-bouncer-iptables

# Nginx 컬렉션 설치
sudo cscli collections install crowdsecurity/nginx

# SSH 컬렉션 설치
sudo cscli collections install crowdsecurity/sshd

# 상태 확인
sudo cscli metrics
sudo cscli alerts list
sudo cscli decisions list
```

### 7.4 자동 컨테이너 업데이트 (Watchtower)

[Watchtower](https://containrrr.dev/watchtower/)로 Docker 이미지를 자동 업데이트한다.

```yaml
# docker-compose.yml에 추가
services:
  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_INCLUDE_STOPPED=false
      - WATCHTOWER_POLL_INTERVAL=86400  # 24시간마다
      - WATCHTOWER_NOTIFICATIONS=email  # 선택
      - WATCHTOWER_LABEL_ENABLE=true    # 레이블 기반 업데이트
    command: --interval 86400 --cleanup
```

### 7.5 의존성 자동 업데이트

**GitHub Dependabot 설정 (`.github/dependabot.yml`):**

```yaml
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
    open-pull-requests-limit: 10
    reviewers:
      - "your-username"
    labels:
      - "dependencies"
      - "security"

  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "weekly"
```

### 7.6 보안 감사 자동화 스크립트

```bash
#!/bin/bash
# security-audit.sh - OpenClaw 보안 감사 스크립트

set -euo pipefail

echo "=== OpenClaw Security Audit ==="
echo "Date: $(date -u +%Y-%m-%dT%H:%M:%SZ)"
echo ""

# 1. Node.js 의존성 취약점
echo "--- npm audit ---"
cd /path/to/openclaw
npm audit --audit-level=moderate 2>&1 || true
echo ""

# 2. Docker 이미지 스캔
echo "--- Trivy Image Scan ---"
trivy image --severity HIGH,CRITICAL openclaw/openclaw:latest 2>&1 || true
echo ""

# 3. .env 파일 권한 확인
echo "--- File Permissions ---"
ENV_PERMS=$(stat -c %a ~/.openclaw/.env 2>/dev/null || echo "NOT FOUND")
if [ "$ENV_PERMS" != "600" ]; then
    echo "WARNING: .env permissions are $ENV_PERMS (should be 600)"
else
    echo "OK: .env permissions are 600"
fi
echo ""

# 4. SSH 설정 확인
echo "--- SSH Config Check ---"
if grep -q "PasswordAuthentication yes" /etc/ssh/sshd_config 2>/dev/null; then
    echo "WARNING: Password authentication is enabled"
else
    echo "OK: Password authentication is disabled"
fi

if grep -q "PermitRootLogin yes" /etc/ssh/sshd_config 2>/dev/null; then
    echo "WARNING: Root login is permitted"
else
    echo "OK: Root login is disabled"
fi
echo ""

# 5. UFW 상태 확인
echo "--- Firewall Status ---"
sudo ufw status verbose 2>&1 || echo "UFW not installed"
echo ""

# 6. Docker 컨테이너 root 실행 확인
echo "--- Docker Root Check ---"
docker ps --format '{{.Names}}: User={{.Label "com.docker.compose.project"}}' 2>&1 || true
echo ""

# 7. SSL 인증서 만료 확인
echo "--- SSL Certificate Check ---"
if [ -f /etc/letsencrypt/live/ai.example.com/fullchain.pem ]; then
    EXPIRY=$(openssl x509 -enddate -noout -in /etc/letsencrypt/live/ai.example.com/fullchain.pem)
    echo "SSL Certificate: $EXPIRY"
else
    echo "No SSL certificate found"
fi
echo ""

echo "=== Audit Complete ==="
```

```bash
# cron으로 주간 자동 감사
echo "0 6 * * 1 /path/to/security-audit.sh >> /var/log/openclaw-audit.log 2>&1" | crontab -
```

---

## 8. 데이터 프라이버시 및 로컬 전용 모드

### 8.1 데이터 흐름 이해

OpenClaw를 사용할 때 데이터가 어디로 전송되는지 이해해야 한다.

| 데이터 유형 | 저장 위치 | 외부 전송 여부 |
| :--- | :--- | :--- |
| 대화 로그 | `~/.openclaw/agents/<id>/sessions/` | AI 프로바이더로 전송 (추론 시) |
| 설정 파일 | `~/.openclaw/config.json` | 전송 안 됨 |
| 인증 정보 | `~/.openclaw/credentials/` | 전송 안 됨 |
| API 키 | `.env` 또는 환경변수 | 각 프로바이더로 전송 (인증 시) |
| 크론 작업 | `~/.openclaw/cron/jobs.json` | 전송 안 됨 |
| 세션 상태 | `~/.openclaw/sessions/` | 전송 안 됨 |

### 8.2 AI 프로바이더별 데이터 정책

| 프로바이더 | 학습 사용 | 데이터 보관 | 참고 |
| :--- | :--- | :--- | :--- |
| Anthropic (Claude) | API 사용 시 학습 안 함 | 30일 후 삭제 | API Terms of Use 참조 |
| OpenAI | API 사용 시 학습 안 함 (기본) | 30일 | 옵트아웃 가능 |
| Google (Gemini) | API 사용 시 학습 안 함 | 다양 | Google AI 약관 참조 |
| Venice AI | 학습 사용 안 함 | 삭제 | 프라이버시 우선 |
| Ollama (로컬) | 해당 없음 | 로컬만 | 완전 오프라인 |

### 8.3 완전 로컬 모드 (Ollama)

외부 API 호출 없이 완전 로컬로 운영하는 방법이다. 프라이버시가 최우선일 때 사용한다.

```bash
# Ollama 설치
curl -fsSL https://ollama.com/install.sh | sh

# 모델 다운로드
ollama pull llama3.3:70b
ollama pull codellama:34b

# OpenClaw 설정
cat > ~/.openclaw/openclaw.json << 'JSONEOF'
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "ollama/llama3.3:70b",
        "fallbacks": ["ollama/codellama:34b"]
      }
    }
  }
}
JSONEOF

# 네트워크 차단 확인 (Docker 사용 시)
# docker-compose.yml의 networks에 internal: true 설정
```

### 8.4 대화 로그 안전 삭제

```bash
# 특정 에이전트의 모든 세션 삭제
rm -rf ~/.openclaw/agents/personal/sessions/*

# 안전 삭제 (복구 불가능하게)
# Linux
find ~/.openclaw/agents/*/sessions/ -type f -exec shred -vfz -n 3 {} \;

# macOS (gshred 사용, brew install coreutils)
find ~/.openclaw/agents/*/sessions/ -type f -exec gshred -vfz -n 3 {} \;

# 자동 세션 정리 (30일 이상 된 세션)
find ~/.openclaw/agents/*/sessions/ -name "*.jsonl" -mtime +30 -delete
```

---

## 9. 법적 준수 가이드 (Compliance)

개인 데이터를 처리하는 경우 법적 의무를 준수해야 한다. SANS Critical AI Security Guidelines와 NIST AI Risk Management Framework를 참고하여 기업 수준의 거버넌스를 구축할 수 있다.

### 9.1 GDPR 실무 체크리스트 (EU 대상)

[GDPR 공식 사이트](https://gdpr.eu) 참조. EU 사용자의 데이터를 처리하는 모든 서비스에 적용된다.

| # | 항목 | 설명 | 실무 대응 (OpenClaw) | 상태 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | **처리 목적 명시** | 어떤 데이터를 왜 수집하는지 명확히 기술 | 서비스 약관에 "AI 비서 기능 수행을 위한 대화 데이터 처리" 명시 | ☐ |
| 2 | **법적 근거** | 6가지 법적 근거 중 하나 확보 (동의, 계약, 법적 의무 등) | 사용자 명시적 동의 획득 | ☐ |
| 3 | **동의 획득** | 사용자로부터 명시적이고 자유로운 동의 | 봇 최초 사용 시 동의 메시지 전송 및 확인 | ☐ |
| 4 | **데이터 최소화** | 목적 달성에 필요한 최소 데이터만 수집 | 불필요한 메타데이터 수집 제한, 세션 TTL 설정 | ☐ |
| 5 | **보관 기간 제한** | 불필요해진 데이터 주기적 삭제 | `find` 기반 세션 자동 삭제 cron 설정 (30일) | ☐ |
| 6 | **접근권 (Access Right)** | 사용자가 자신의 데이터 조회 가능 | 세션 데이터 Export 기능 제공 | ☐ |
| 7 | **삭제권 (Right to Erasure)** | 사용자 요청 시 데이터 완전 삭제 | `shred` 또는 `gshred`로 안전 삭제 스크립트 준비 | ☐ |
| 8 | **데이터 이동권** | 데이터를 구조화된 형식으로 내보내기 | JSON/CSV Export 기능 | ☐ |
| 9 | **보안 조치** | 적절한 기술적/관리적 보안 조치 적용 | 본 가이드의 모든 보안 설정 적용 | ☐ |
| 10 | **침해 통지** | 72시간 내 감독 기관에 통지 | 침해 대응 절차서(Incident Response Plan) 수립 | ☐ |
| 11 | **국외 이전** | EU 외부로 데이터 이전 시 적정성 결정 또는 SCC 필요 | AI 프로바이더 서버 위치 확인 및 고지 | ☐ |
| 12 | **DPO 지정** | 대규모 처리 시 데이터 보호 책임자 지정 | 해당 시 DPO 임명 | ☐ |

### 9.2 한국 개인정보보호법(PIPA) 체크리스트

[국가법령정보센터 개인정보보호법](https://www.law.go.kr/%EB%B2%95%EB%A0%B9/%EA%B0%9C%EC%9D%B8%EC%A0%95%EB%B3%B4%EB%B3%B4%ED%98%B8%EB%B2%95) 참조. 한국에서 개인정보를 처리하는 모든 사업자에게 적용된다.

| 조항 | 항목 | 상세 설명 | 실무 대응 (OpenClaw) | 상태 |
| :--- | :--- | :--- | :--- | :--- |
| **제15조** | **수집/이용 동의** | 개인정보 수집 시 수집 목적, 항목, 보유기간을 고지하고 동의를 받아야 함 | 서비스 이용 동의서에 AI 대화 데이터 수집/이용 목적 명시. 봇 최초 연결 시 동의 절차 구현 | ☐ |
| **제17조** | **제3자 제공** | AI 프로바이더(Anthropic, OpenAI 등)에 대화 내용이 전달되는 것은 제3자 제공에 해당할 수 있음 | 사용자에게 AI 프로바이더로의 데이터 전송 사실 고지 및 동의 획득 | ☐ |
| **제21조** | **개인정보 파기** | 보유기간 경과 또는 처리 목적 달성 시 지체 없이 파기 | `~/.openclaw/sessions/` 내 파일을 `shred`로 완전 삭제. 자동 파기 cron 설정 | ☐ |
| **제24조의2** | **주민등록번호 처리 제한** | 주민번호 처리 원칙적 금지 | AI 대화에서 주민번호 입력 감지 시 경고 또는 마스킹 처리 | ☐ |
| **제26조** | **처리 위탁** | 외부 AI 프로바이더에게 처리를 위탁하는 경우 위탁 계약 체결 및 고지 필요 | OpenAI/Anthropic DPA(Data Processing Agreement) 체결. 개인정보 처리방침에 위탁 업체 목록 공개 | ☐ |
| **제28조의2** | **가명정보 처리** | 통계, 연구 목적으로 가명처리 가능 | 로그 분석 시 개인 식별 정보 가명처리 후 사용 | ☐ |
| **제29조** | **안전조치 의무** | 접근 통제, 접속기록 보관(최소 6개월), 암호화, 백신 등 기술적 조치 | 본 가이드의 접근 제어, 로깅(6개월 보관), SSL/TLS 암호화, Docker 격리 설정 적용 | ☐ |
| **제34조** | **침해 통지** | 개인정보 침해 발생 시 72시간 내 정보주체 및 PIPC에 통지 | 침해 사고 대응 매뉴얼 수립, 연락처 목록 유지 | ☐ |
| **제39조의3** | **동의 철회** | 정보주체의 동의 철회 시 개인정보 처리 중지 및 파기 | 봇 명령어 `/delete-my-data` 구현으로 즉시 삭제 처리 | ☐ |

### 9.3 AI 특화 규제 동향 (2025-2026)

| 규제 | 적용 지역 | OpenClaw 관련 사항 |
| :--- | :--- | :--- |
| EU AI Act | EU | AI 시스템 위험 등급 분류. OpenClaw는 "제한적 위험" 범주일 가능성. 투명성 의무 적용 |
| 한국 AI 기본법 (제정 진행 중) | 한국 | AI 서비스 투명성, 설명 가능성 요구 예상 |
| 미국 주별 AI 규제 | 미국 | 주마다 상이. 일리노이 BIPA, 캘리포니아 CCPA 등 |

---

## 10. 인프라별 상세 셀프호스팅 가이드

### 10.1 Mac mini (Home Server)

비용 효율적인 가정용 AI 서버로 적합하다.

**기본 보안 설정:**

| 항목 | 설정 방법 | 비고 |
| :--- | :--- | :--- |
| FileVault | `시스템 설정 > 개인정보 보호 및 보안 > FileVault 켜기` | 디스크 전체 암호화 |
| 방화벽 | `시스템 설정 > 네트워크 > 방화벽 > 켜기` | 들어오는 연결 차단 |
| 자동 잠금 | `시스템 설정 > 잠금 화면 > 즉시` | 화면보호기 암호 |
| 자동 로그인 비활성화 | `시스템 설정 > 사용자 및 그룹 > 자동 로그인 끄기` | 물리적 접근 방어 |
| 원격 로그인 | `시스템 설정 > 일반 > 공유 > 원격 로그인` | SSH 접속 허용 (필요시만) |

```bash
# macOS 방화벽 CLI 설정
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setblockall on

# OpenClaw 실행 (macOS)
openclaw gateway run --bind loopback --port 18789
# 또는 메뉴바 앱을 통해 실행
```

**전원 관리:**
- UPS(무정전 전원장치) 사용 권장
- `에너지 절약 > 정전 후 자동 시동` 활성화
- NUT(Network UPS Tools)로 UPS 모니터링

### 10.2 Raspberry Pi 5

저전력 상시 가동 서버에 적합하다. ARM64 기반으로 Node.js v22+를 지원한다.

```bash
# 기본 보안 설정
# 1. 기본 사용자 변경
sudo adduser openclaw
sudo usermod -aG sudo openclaw
sudo userdel -r pi  # 기본 pi 사용자 삭제

# 2. SSH 키 설정 (비밀번호 로그인 비활성화)
ssh-copy-id -i ~/.ssh/openclaw_ed25519.pub openclaw@raspberrypi.local
# /etc/ssh/sshd_config에서 PasswordAuthentication no

# 3. 방화벽 설정
sudo apt install ufw
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow 22/tcp
sudo ufw enable

# 4. 자동 보안 업데이트
sudo apt install unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades

# 5. USB SSD 부팅 설정 (SD카드 수명 문제 해결)
sudo raspi-config  # Advanced Options > Boot Order > USB Boot

# 6. Node.js v22 설치
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt install -y nodejs

# 7. OpenClaw 설치 및 서비스 등록
sudo npm install -g openclaw
```

**systemd 서비스 파일 (`/etc/systemd/system/openclaw.service`):**

```ini
[Unit]
Description=OpenClaw Gateway
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=openclaw
Group=openclaw
WorkingDirectory=/home/openclaw
ExecStart=/usr/bin/node /usr/lib/node_modules/openclaw/dist/index.js gateway run --bind loopback --port 18789
Restart=always
RestartSec=10
Environment=NODE_ENV=production

# 보안 하드닝
NoNewPrivileges=yes
ProtectSystem=strict
ProtectHome=read-only
ReadWritePaths=/home/openclaw/.openclaw
PrivateTmp=yes
ProtectKernelTunables=yes
ProtectControlGroups=yes

[Install]
WantedBy=multi-user.target
```

```bash
# 서비스 등록 및 시작
sudo systemctl daemon-reload
sudo systemctl enable openclaw
sudo systemctl start openclaw
sudo systemctl status openclaw
```

**냉각:** AI 워크로드는 발열이 심하므로 활성 쿨러(팬)가 필수이다. Pimoroni 또는 공식 Active Cooler를 사용한다.

### 10.3 Synology NAS

기존 NAS 인프라를 활용하여 OpenClaw를 운영할 수 있다.

| 항목 | 설정 |
| :--- | :--- |
| **Container Manager** | Docker 패키지를 사용하여 OpenClaw 구동 |
| **보안 어드바이저** | 내장 '보안 어드바이저' 앱으로 취약점 점검 |
| **계정 보안** | 기본 `admin` 비활성화, 2FA 활성화 |
| **역방향 프록시** | 제어판 > 로그인 포털 > 역방향 프록시 |
| **방화벽** | 제어판 > 보안 > 방화벽에서 규칙 설정 |
| **IP 차단** | 자동 차단 기능 활성화 (10분 내 5회 실패 시 차단) |
| **SSL** | 제어판 > 보안 > 인증서에서 Let's Encrypt 발급 |

```yaml
# Synology Container Manager용 docker-compose.yml
version: '3.8'
services:
  openclaw:
    image: openclaw/openclaw:latest
    container_name: openclaw
    restart: unless-stopped
    user: "1001:1001"
    ports:
      - "127.0.0.1:18789:18789"
    volumes:
      - /volume1/docker/openclaw/data:/home/openclaw/.openclaw
    environment:
      - OPENCLAW_GATEWAY_TOKEN=${GATEWAY_TOKEN}
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true
```

### 10.4 VPS (Hetzner, Contabo, AWS 등)

클라우드 VPS에서 운영 시 추가 보안이 필요하다.

```bash
# === VPS 초기 보안 설정 스크립트 ===

# 1. 시스템 업데이트
sudo apt update && sudo apt upgrade -y

# 2. 자동 보안 업데이트
sudo apt install unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades

# 3. 전용 사용자 생성
sudo adduser openclaw --disabled-password
sudo usermod -aG docker openclaw

# 4. SSH 하드닝 (5장 참조)

# 5. UFW 방화벽 (4.4장 참조)

# 6. Fail2Ban (5.3장 참조)

# 7. Docker 설치 및 보안 설정
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker openclaw

# 8. 모니터링 (CrowdSec)
curl -s https://packagecloud.io/install/repositories/crowdsec/crowdsec/script.deb.sh | sudo bash
sudo apt install crowdsec

# 9. Swap 설정 (메모리 부족 방지)
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

**VPS 제공사별 추가 보안:**

| 제공사 | 보안 기능 | 설정 |
| :--- | :--- | :--- |
| **Hetzner** | Cloud Firewall | Hetzner Console > Firewalls |
| **AWS** | Security Groups, VPC | EC2 Console > Security Groups |
| **Contabo** | 제공 없음 (OS 레벨만) | UFW + Fail2Ban 필수 |
| **DigitalOcean** | Cloud Firewall, VPC | Networking > Firewalls |

---

## 11. 백업 암호화 및 재해 복구

### 11.1 GPG를 이용한 암호화 백업

```bash
#!/bin/bash
# backup-openclaw.sh - OpenClaw 암호화 백업 스크립트

set -euo pipefail

BACKUP_DIR="/backup/openclaw"
OPENCLAW_DIR="$HOME/.openclaw"
DATE=$(date +%Y%m%d_%H%M%S)
TARGET="$BACKUP_DIR/openclaw_backup_$DATE"

# 디렉토리 생성
mkdir -p "$BACKUP_DIR"

# 1. 필수 데이터 압축
echo "Creating backup archive..."
tar -czf "$TARGET.tar.gz" \
    -C "$HOME" \
    .openclaw/config.json \
    .openclaw/agents/ \
    .openclaw/cron/ \
    .openclaw/settings/ \
    --exclude='*.tmp' \
    --exclude='node_modules'

# 2. GPG 대칭키 암호화 (AES-256)
echo "Encrypting backup..."
gpg --symmetric \
    --cipher-algo AES256 \
    --batch \
    --passphrase-file "$HOME/.backup_passphrase" \
    --output "$TARGET.tar.gz.gpg" \
    "$TARGET.tar.gz"

# 3. 원본 삭제
rm -f "$TARGET.tar.gz"

# 4. 체크섬 생성
sha256sum "$TARGET.tar.gz.gpg" > "$TARGET.tar.gz.gpg.sha256"

# 5. 오래된 백업 삭제 (30일 이상)
find "$BACKUP_DIR" -name "*.gpg" -mtime +30 -delete
find "$BACKUP_DIR" -name "*.sha256" -mtime +30 -delete

echo "Backup complete: $TARGET.tar.gz.gpg"
echo "Checksum: $(cat $TARGET.tar.gz.gpg.sha256)"
```

**복원 스크립트:**

```bash
#!/bin/bash
# restore-openclaw.sh

set -euo pipefail

BACKUP_FILE="$1"

if [ -z "$BACKUP_FILE" ]; then
    echo "Usage: $0 <backup_file.tar.gz.gpg>"
    exit 1
fi

# 1. 체크섬 검증
echo "Verifying checksum..."
sha256sum -c "${BACKUP_FILE}.sha256"

# 2. 복호화
echo "Decrypting backup..."
gpg --decrypt \
    --batch \
    --passphrase-file "$HOME/.backup_passphrase" \
    --output /tmp/openclaw_restore.tar.gz \
    "$BACKUP_FILE"

# 3. 복원 (기존 데이터 백업 후)
echo "Restoring..."
cp -r "$HOME/.openclaw" "$HOME/.openclaw.bak.$(date +%s)"
tar -xzf /tmp/openclaw_restore.tar.gz -C "$HOME"

# 4. 임시 파일 삭제
rm -f /tmp/openclaw_restore.tar.gz

echo "Restore complete. Previous data backed up to ~/.openclaw.bak.*"
```

### 11.2 원격 백업 (Rclone)

[Rclone](https://rclone.org)의 `crypt` 리모트를 사용하면 전송 전 클라이언트 측 암호화가 가능하다.

```bash
# Rclone 설치
curl https://rclone.org/install.sh | sudo bash

# Rclone 설정 (S3 예시)
rclone config
# name: s3-backup
# type: s3
# provider: AWS (또는 Backblaze B2, Cloudflare R2 등)

# 암호화 리모트 설정
rclone config
# name: s3-encrypted
# type: crypt
# remote: s3-backup:openclaw-backups
# password: (자동 생성)
# password2: (자동 생성)

# 암호화된 원격 백업
rclone sync /backup/openclaw s3-encrypted:/backups --progress

# cron으로 매일 백업
echo "0 4 * * * rclone sync /backup/openclaw s3-encrypted:/backups --log-file=/var/log/rclone.log" | crontab -
```

### 11.3 3-2-1 백업 전략

| 규칙 | 설명 | OpenClaw 적용 |
| :--- | :--- | :--- |
| **3**개 사본 | 원본 + 2개 복사본 | 로컬, 외장 드라이브, 클라우드 |
| **2**종 매체 | 서로 다른 저장 매체 | SSD + 클라우드 (S3/B2) |
| **1**개 원격 | 최소 1개는 원격 보관 | Rclone으로 클라우드 동기화 |

---

## 12. 모니터링 및 로깅

### 12.1 로그 관리

```bash
# Gateway 로그 확인
tail -f /tmp/openclaw-gateway.log

# macOS 통합 로그 (macOS 앱 사용 시)
./scripts/clawlog.sh

# Docker 로그
docker logs -f openclaw-gateway --tail 100

# 로그 로테이션 설정 (/etc/logrotate.d/openclaw)
cat > /etc/logrotate.d/openclaw << 'EOF'
/var/log/openclaw/*.log {
    daily
    missingok
    rotate 90
    compress
    delaycompress
    notifempty
    create 0640 openclaw openclaw
    sharedscripts
    postrotate
        systemctl reload openclaw > /dev/null 2>&1 || true
    endscript
}
EOF
```

### 12.2 접속 기록 보관 (법적 요구)

한국 개인정보보호법 제29조에 따라 접속 기록을 최소 6개월 보관해야 한다.

```bash
# Nginx 접속 로그 보관 설정
# /etc/logrotate.d/nginx-openclaw
/var/log/nginx/openclaw_access.log {
    daily
    rotate 180  # 6개월 (180일)
    compress
    delaycompress
    notifempty
    create 0640 www-data adm
}
```

### 12.3 리소스 모니터링

```bash
# Docker 컨테이너 리소스 사용량
docker stats openclaw-gateway

# [Portainer](https://www.portainer.io) 설치 (Docker GUI 관리)
docker run -d \
  -p 9443:9443 \
  --name portainer \
  --restart=always \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v portainer_data:/data \
  portainer/portainer-ce:latest
```

### 12.4 이상 탐지 알림

```bash
# 디스크 사용량 알림 (90% 초과 시)
DISK_USAGE=$(df -h / | awk 'NR==2{print $5}' | sed 's/%//')
if [ "$DISK_USAGE" -gt 90 ]; then
    echo "WARNING: Disk usage is ${DISK_USAGE}%"
    # Telegram/Discord로 알림 전송
fi

# 메모리 사용량 모니터링
FREE_MEM=$(free -m | awk 'NR==2{print $4}')
if [ "$FREE_MEM" -lt 256 ]; then
    echo "WARNING: Free memory is ${FREE_MEM}MB"
fi
```

---

## 13. 업데이트 및 패치 관리

### 13.1 OpenClaw 업데이트

```bash
# 현재 버전 확인
openclaw --version

# 최신 버전으로 업데이트
sudo npm install -g openclaw@latest

# Docker 이미지 업데이트
docker pull openclaw/openclaw:latest
docker compose up -d  # 컨테이너 재생성
```

### 13.2 Node.js 보안 패치

OpenClaw는 Node.js v22+를 요구한다. 보안 패치가 포함된 최신 LTS를 유지해야 한다.

```bash
# nvm으로 Node.js 업데이트
nvm install 22 --lts
nvm use 22
nvm alias default 22

# 버전 확인
node --version  # v22.x.x 이상
```

### 13.3 자동 OS 보안 업데이트

```bash
# Ubuntu/Debian
sudo apt install unattended-upgrades
sudo cat > /etc/apt/apt.conf.d/50unattended-upgrades << 'EOF'
Unattended-Upgrade::Allowed-Origins {
    "${distro_id}:${distro_codename}-security";
};
Unattended-Upgrade::Automatic-Reboot "false";
Unattended-Upgrade::Mail "admin@example.com";
EOF
```

---

## 14. 실전 공격 시나리오와 대응

### 14.1 시나리오 1: API 키 유출 사고

**상황:** `.env` 파일이 실수로 GitHub에 푸시됨. Anthropic API 키가 노출.

**대응 절차:**

```bash
# 1. 즉시 키 무효화
# Anthropic Console에서 해당 API 키 삭제

# 2. Git 히스토리에서 제거
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch .env" \
  --prune-empty --tag-name-filter cat -- --all
git push --force

# 3. 새 키 발급 및 환경변수 교체
openssl rand -hex 32 > /tmp/new_gateway_token
# Anthropic Console에서 새 API 키 발급

# 4. BFG Repo-Cleaner로 확실한 정리
bfg --delete-files .env
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# 5. GitHub Secret Scanning 알림 확인
# GitHub Security 탭에서 알림 확인 및 해제
```

### 14.2 시나리오 2: 프롬프트 인젝션 공격

**상황:** 공격자가 그룹 채팅에서 악의적 프롬프트를 전송하여 시스템 명령 실행 시도.

**대응:**

| 방어 단계 | 조치 |
| :--- | :--- |
| **예방** | 에이전트의 도구 허용 목록 제한: `tools.deny: ["exec", "write", "edit"]` |
| **탐지** | 대화 로그에서 의심스러운 패턴 모니터링 (시스템 명령, 파일 경로 포함) |
| **대응** | 해당 사용자를 allowlist에서 제거, 채널 일시 비활성화 |
| **복구** | 세션 초기화 (`/reset`), 영향받은 파일 무결성 확인 |

```json5
// 안전한 에이전트 설정 예시
{
  agents: {
    list: [{
      id: "public-group",
      workspace: "~/.openclaw/workspace-public",
      sandbox: { mode: "all", scope: "agent" },
      tools: {
        allow: ["read", "sessions_list"],
        deny: ["exec", "write", "edit", "apply_patch", "browser", "canvas"]
      }
    }]
  }
}
```

### 14.3 시나리오 3: Gateway 포트 무단 접근

**상황:** `18789` 포트가 외부에 노출되어 공격자가 API 호출 시도.

**대응:**

```bash
# 1. 즉시 포트 차단
sudo ufw deny 18789

# 2. Gateway를 루프백으로 재시작
openclaw gateway run --bind loopback --port 18789

# 3. 접속 로그 확인
sudo cat /var/log/nginx/openclaw_access.log | grep "suspicious"

# 4. Gateway 토큰 변경
export OPENCLAW_GATEWAY_TOKEN=$(openssl rand -hex 32)

# 5. 침입 여부 확인
sudo cscli alerts list  # CrowdSec
sudo fail2ban-client status  # Fail2Ban
```

### 14.4 시나리오 4: 의존성 취약점 악용

**상황:** npm 패키지에서 Critical 취약점(CVE)이 발견됨.

```bash
# 1. 취약점 확인
npm audit

# 2. 즉시 패치 가능한 경우
npm audit fix

# 3. Breaking change가 있는 경우
npm audit fix --force  # 주의: 호환성 테스트 필요

# 4. Docker 이미지 재빌드
docker build --no-cache -t openclaw/openclaw:patched .
trivy image openclaw/openclaw:patched

# 5. 배포
docker compose up -d
```

### 14.5 시나리오 5: 세션 하이재킹

**상황:** Telegram Bot 토큰이 유출되어 공격자가 봇으로 위장.

```bash
# 1. 즉시 BotFather에서 토큰 재발급
# @BotFather → /revoke → 새 토큰 발급

# 2. OpenClaw 설정 업데이트
openclaw config set channels.telegram.token "NEW_TOKEN"

# 3. 모든 활성 세션 무효화
rm -rf ~/.openclaw/agents/*/sessions/*

# 4. allowlist 재검토
# 허용된 사용자 목록 확인 및 의심스러운 항목 제거

# 5. Gateway 재시작
openclaw gateway run --bind loopback --port 18789 --force
```

---

## 참고 자료 (References)

### 도구 및 서비스

| # | 도구 | URL | 용도 |
| :--- | :--- | :--- | :--- |
| 1 | Tailscale | [https://tailscale.com](https://tailscale.com) | 간편한 VPN 솔루션 |
| 2 | WireGuard | [https://www.wireguard.com](https://www.wireguard.com) | 고성능 VPN 프로토콜 |
| 3 | Let's Encrypt | [https://letsencrypt.org](https://letsencrypt.org) | 무료 SSL 인증서 |
| 4 | Certbot | [https://certbot.eff.org](https://certbot.eff.org) | SSL 인증서 발급 자동화 도구 |
| 5 | Traefik | [https://doc.traefik.io/traefik/](https://doc.traefik.io/traefik/) | 클라우드 네이티브 리버스 프록시 |
| 6 | Nginx | [https://nginx.org/en/docs/](https://nginx.org/en/docs/) | 고성능 웹 서버 및 리버스 프록시 |
| 7 | Portainer | [https://www.portainer.io](https://www.portainer.io) | Docker 컨테이너 관리 GUI |
| 8 | Watchtower | [https://containrrr.dev/watchtower/](https://containrrr.dev/watchtower/) | Docker 컨테이너 자동 업데이트 |
| 9 | Fail2Ban | [https://github.com/fail2ban/fail2ban](https://github.com/fail2ban/fail2ban) | 침입 차단 시스템 |
| 10 | Docker Security | [https://docs.docker.com/engine/security/](https://docs.docker.com/engine/security/) | Docker 공식 보안 가이드 |
| 11 | OWASP Top 10 | [https://owasp.org/www-project-top-ten/](https://owasp.org/www-project-top-ten/) | 웹 애플리케이션 보안 위험 |
| 12 | 1Password CLI | [https://developer.1password.com/docs/cli](https://developer.1password.com/docs/cli) | 비밀번호 및 시크릿 관리 |
| 13 | HashiCorp Vault | [https://www.vaultproject.io](https://www.vaultproject.io) | 엔터프라이즈급 시크릿 관리 |
| 14 | npm audit | [https://docs.npmjs.com/cli/v10/commands/npm-audit](https://docs.npmjs.com/cli/v10/commands/npm-audit) | Node.js 보안 감사 |
| 15 | Trivy | [https://trivy.dev](https://trivy.dev) | 컨테이너 보안 스캐너 |
| 16 | CrowdSec | [https://www.crowdsec.net](https://www.crowdsec.net) | 협업형 침입 방지 시스템 |
| 17 | Rclone | [https://rclone.org](https://rclone.org) | 클라우드 스토리지 동기화 및 암호화 |
| 18 | OWASP Docker Security | [https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html](https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html) | Docker 보안 치트시트 |

### 법률 및 규제

| # | 규제 | URL | 관할 |
| :--- | :--- | :--- | :--- |
| 19 | 한국 개인정보보호법 | [https://www.law.go.kr/법령/개인정보보호법](https://www.law.go.kr/%EB%B2%95%EB%A0%B9/%EA%B0%9C%EC%9D%B8%EC%A0%95%EB%B3%B4%EB%B3%B4%ED%98%B8%EB%B2%95) | 한국 |
| 20 | GDPR | [https://gdpr.eu](https://gdpr.eu) | EU |

### AI 보안 가이드

| # | 자료 | URL | 설명 |
| :--- | :--- | :--- | :--- |
| 21 | Anthropic Claude Code Sandboxing | [https://www.anthropic.com/engineering/claude-code-sandboxing](https://www.anthropic.com/engineering/claude-code-sandboxing) | Claude Code 샌드박싱 설계 |
| 22 | Claude Code Security Docs | [https://code.claude.com/docs/en/security](https://code.claude.com/docs/en/security) | Claude Code 공식 보안 문서 |
| 23 | SANS AI Security Guidelines | [https://www.sans.org/blog/securing-ai-in-2025-a-risk-based-approach-to-ai-controls-and-governance](https://www.sans.org/blog/securing-ai-in-2025-a-risk-based-approach-to-ai-controls-and-governance) | AI 보안 위험 기반 접근 |
| 24 | Sysdig Dockerfile Best Practices | [https://www.sysdig.com/learn-cloud-native/dockerfile-best-practices](https://www.sysdig.com/learn-cloud-native/dockerfile-best-practices) | Dockerfile 보안 모범 사례 |

---

> 이 문서는 2026년 1월 기준으로 작성되었다. 보안 위협과 모범 사례는 지속적으로 변화하므로 정기적인 업데이트가 필요하다.
>
> OpenClaw 프로젝트 경로: `~/.openclaw/` (설정), 프로젝트 소스: [GitHub](https://github.com/openclaw/openclaw)
