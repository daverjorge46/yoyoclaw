# OpenClaw 智能路由系统

## 🚀 快速开始

OpenClaw 智能路由系统可以自动选择最合适的AI模型来处理您的请求，既保证质量又优化成本。

### 💡 前缀指令（推荐使用）

想更精确地控制模型选择？试试在消息开头加上以下前缀：

#### 旗舰模型（更强，更准确）

```
旗舰: 帮我设计一个完整的Web应用架构
F: 实现一个用户认证系统
Force: 分析这段代码的性能瓶颈
```

**适用场景**：
- 复杂的编程任务
- 架构设计
- 深度分析
- 创意写作

#### 轻量模型（更快，更经济）

```
轻量: 简单解释什么是闭包
L: 这段代码是干什么的？
Fast: 快速回答一个简单问题
```

**适用场景**：
- 简单问答
- 代码解释
- 快速查询
- 日常对话

---

## 🎯 工作原理

智能路由系统通过三个层级来决策：

### 1️⃣ 前缀检测（最高优先级）

如果您使用前缀指令（如 `旗舰:` 或 `轻量:`），系统会立即使用您指定的模型。

### 2️⃣ 学习记忆（用户偏好）

系统会记住您的选择。下次遇到类似问题时，会自动使用您之前偏好的模型。

### 3️⃣ 意图识别（智能分析）

如果没有明确指令，系统会分析您的查询意图，自动选择最合适的模型。

---

## 📊 性能对比

| 场景 | 无智能路由 | 使用智能路由 | 节省 |
|------|-----------|-------------|------|
| 日常闲聊 | 旗舰模型 | 轻量模型 | ~90% |
| 简单问答 | 旗舰模型 | 轻量模型 | ~85% |
| 复杂编程 | 轻量模型（失败重试） | 旗舰模型 | 零等待 |

---

## 🛠️ 配置

智能路由系统会在首次运行时自动创建配置文件：

```
~/.openclaw/smart-router/
├── base-dna.json          # 静态意图特征（自动生成）
├── user_memory.bin       # 用户学习数据
└── config.json           # 路由配置
```

---

## 🔧 高级功能

### 自动学习

每次您使用前缀指令时，系统会自动学习：
- 清理前缀后的查询会被向量化
- 存储到用户记忆中
- 下次自动应用您的偏好

### 时间衰减

系统会自动"遗忘"过时的偏好：
- 30天未使用的偏好会降权
- 90天未使用的偏好会被删除
- 保持系统对您当前习惯的敏感度

### 离线保护

如果Embedding API不可用：
- 系统会回退到关键词匹配
- 支持中英文双语关键词
- 确保服务始终可用

---

## ❓ 常见问题

### Q: 为什么要用前缀而不是自然语言？

A: 前缀更精确！例如：
- ✅ `旗舰: 帮我写个脚本` → 使用旗舰模型
- ❌ `旗舰店在哪里` → 不会误触发旗舰模型

冒号或空格是关键分隔符。

### Q: 我的数据安全吗？

A: 完全安全！所有数据都存储在本地：
- 查询向量（无法还原原文）
- 模型偏好（仅用于路由）
- 不上传任何内容到云端

### Q: 如何重置学习数据？

A: 删除 `~/.openclaw/smart-router/user_memory.bin` 文件，系统会自动重新开始学习。

### Q: 支持哪些模型？

A: 支持OpenClaw配置的所有模型。系统会自动从您的配置中推断轻量和旗舰模型。

---

## 📝 更新日志

### v1.0.0 (2026-01-31)
- ✅ 前缀触发系统
- ✅ 用户学习记忆
- ✅ 意图DNA识别
- ✅ 离线关键词匹配
- ✅ 二进制向量存储
- ✅ 时间衰减权重
- ✅ DBSCAN智能压缩

---

## 💬 反馈

如有问题或建议，请访问：
- GitHub: https://github.com/anthropics/openclaw
- Discord: OpenClaw社区

**让AI更懂你，让使用更高效！** 🚀
